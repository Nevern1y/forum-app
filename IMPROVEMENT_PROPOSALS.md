# üöÄ –ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –ø–æ —É–ª—É—á—à–µ–Ω–∏—é —Ñ–æ—Ä—É–º-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

## üìã –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ
1. [–°–∏—Å—Ç–µ–º–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π](#1-—Å–∏—Å—Ç–µ–º–∞-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π)
2. [–ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π –ø–æ–∏—Å–∫](#2-–ø—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π-–ø–æ–∏—Å–∫)
3. [–ü—Ä–∏–≤–∞—Ç–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è](#3-–ø—Ä–∏–≤–∞—Ç–Ω—ã–µ-—Å–æ–æ–±—â–µ–Ω–∏—è)
4. [–ú–æ–¥–µ—Ä–∞—Ü–∏—è –∏ —Ä–µ–ø–æ—Ä—Ç—ã](#4-–º–æ–¥–µ—Ä–∞—Ü–∏—è-–∏-—Ä–µ–ø–æ—Ä—Ç—ã)
5. [–ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –¥–ª—è –∞–≤—Ç–æ—Ä–æ–≤](#5-–∞–Ω–∞–ª–∏—Ç–∏–∫–∞-–¥–ª—è-–∞–≤—Ç–æ—Ä–æ–≤)
6. [–ü–æ–¥–ø–∏—Å–∫–∏ –Ω–∞ –∞–≤—Ç–æ—Ä–æ–≤](#6-–ø–æ–¥–ø–∏—Å–∫–∏-–Ω–∞-–∞–≤—Ç–æ—Ä–æ–≤)
7. [–†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π Markdown —Ä–µ–¥–∞–∫—Ç–æ—Ä](#7-—Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π-markdown-—Ä–µ–¥–∞–∫—Ç–æ—Ä)
8. [SEO –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è](#8-seo-–æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è)
9. [–ì–µ–π–º–∏—Ñ–∏–∫–∞—Ü–∏—è –∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è](#9-–≥–µ–π–º–∏—Ñ–∏–∫–∞—Ü–∏—è-–∏-–¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è)
10. [AI-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç –¥–ª—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞](#10-ai-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç-–¥–ª—è-–∫–æ–Ω—Ç–µ–Ω—Ç–∞)

---

## 1. –°–∏—Å—Ç–µ–º–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

### üìù –û–ø–∏—Å–∞–Ω–∏–µ
–ü–æ–ª–Ω–æ—Ü–µ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π —Å realtime –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è–º–∏, –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–æ–π –∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π.

### üéØ –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
- ‚úÖ –¢–∞–±–ª–∏—Ü–∞ `notifications` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
- ‚ö†Ô∏è UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π
- ‚ùå –ù–µ—Ç realtime –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π
- ‚ùå –ù–µ—Ç –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏ –ø–æ—Ö–æ–∂–∏—Ö —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
- ‚ùå –ù–µ—Ç –Ω–∞—Å—Ç—Ä–æ–µ–∫ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

### üí° –ß—Ç–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å

#### A. –¢–∏–ø—ã —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
```typescript
enum NotificationType {
  COMMENT = 'comment',          // –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –∫ –≤–∞—à–µ–º—É –ø–æ—Å—Ç—É
  REPLY = 'reply',              // –û—Ç–≤–µ—Ç –Ω–∞ –≤–∞—à –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π
  REACTION = 'reaction',        // –†–µ–∞–∫—Ü–∏—è –Ω–∞ –ø–æ—Å—Ç/–∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π
  MENTION = 'mention',          // –£–ø–æ–º–∏–Ω–∞–Ω–∏–µ @username
  FOLLOW = 'follow',            // –ù–æ–≤—ã–π –ø–æ–¥–ø–∏—Å—á–∏–∫
  MILESTONE = 'milestone',      // –î–æ—Å—Ç–∏–∂–µ–Ω–∏–µ (100 –ª–∞–π–∫–æ–≤ –∏ —Ç.–¥.)
  SYSTEM = 'system',            // –°–∏—Å—Ç–µ–º–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
  MODERATION = 'moderation'     // –î–µ–π—Å—Ç–≤–∏—è –º–æ–¥–µ—Ä–∞—Ç–æ—Ä–æ–≤
}
```

#### B. UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

**Notification Bell:**
```tsx
// components/notifications/notification-bell.tsx
- Badge —Å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º –Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã—Ö
- Dropdown —Å –ø–æ—Å–ª–µ–¥–Ω–∏–º–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è–º–∏
- –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ (3 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ª–∞–π–∫–Ω—É–ª–∏ –≤–∞—à –ø–æ—Å—Ç)
- Realtime –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —á–µ—Ä–µ–∑ Supabase
- –ó–≤—É–∫–æ–≤—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
```

**Notification Center:**
```tsx
// app/notifications/page.tsx
- –ü–æ–ª–Ω—ã–π —Å–ø–∏—Å–æ–∫ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
- –§–∏–ª—å—Ç—Ä—ã –ø–æ —Ç–∏–ø–∞–º
- –ü–∞–≥–∏–Ω–∞—Ü–∏—è (infinite scroll)
- –ú–∞—Å—Å–æ–≤—ã–µ –¥–µ–π—Å—Ç–≤–∏—è (–æ—Ç–º–µ—Ç–∏—Ç—å –≤—Å–µ –∫–∞–∫ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω–æ–µ)
- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
```

#### C. –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

```typescript
interface NotificationSettings {
  email: {
    enabled: boolean
    types: NotificationType[]
    frequency: 'instant' | 'daily' | 'weekly'
  }
  push: {
    enabled: boolean
    types: NotificationType[]
  }
  inApp: {
    enabled: boolean
    types: NotificationType[]
    sound: boolean
  }
}
```

### üõ†Ô∏è –®–∞–≥–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

**–§–∞–∑–∞ 1: –ë–∞–∑–æ–≤—ã–π UI (2-3 –¥–Ω—è)**
```bash
1. –°–æ–∑–¥–∞—Ç—å NotificationBell –∫–æ–º–ø–æ–Ω–µ–Ω—Ç
2. –°–æ–∑–¥–∞—Ç—å NotificationItem –∫–æ–º–ø–æ–Ω–µ–Ω—Ç
3. –î–æ–±–∞–≤–∏—Ç—å –≤ navbar
4. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å fetch —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
5. –î–æ–±–∞–≤–∏—Ç—å –ø–∞–≥–∏–Ω–∞—Ü–∏—é
```

**–§–∞–∑–∞ 2: Realtime (1-2 –¥–Ω—è)**
```bash
1. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å Supabase Realtime –¥–ª—è notifications
2. –î–æ–±–∞–≤–∏—Ç—å subscription –≤ NotificationBell
3. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –æ–ø—Ç–∏–º–∏—Å—Ç–∏—á–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
4. –î–æ–±–∞–≤–∏—Ç—å –∑–≤—É–∫–æ–≤—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
```

**–§–∞–∑–∞ 3: –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ (2 –¥–Ω—è)**
```bash
1. –°–æ–∑–¥–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—é –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏ –ø–æ—Ö–æ–∂–∏—Ö —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
2. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å UI –¥–ª—è —Å–≥—Ä—É–ø–ø–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö
3. –î–æ–±–∞–≤–∏—Ç—å —Ä–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–Ω–∏–µ –≥—Ä—É–ø–ø
```

**–§–∞–∑–∞ 4: –ù–∞—Å—Ç—Ä–æ–π–∫–∏ (1-2 –¥–Ω—è)**
```bash
1. –°–æ–∑–¥–∞—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É –Ω–∞—Å—Ç—Ä–æ–µ–∫
2. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ user_metadata
3. –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —Ñ–∏–ª—å—Ç—Ä–æ–≤
```

### ‚ö†Ô∏è –†–∏—Å–∫–∏
- **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**: –ú–Ω–æ–≥–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π = –º–µ–¥–ª–µ–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã
  - *–†–µ—à–µ–Ω–∏–µ*: –ò–Ω–¥–µ–∫—Å—ã, –ø–∞–≥–∏–Ω–∞—Ü–∏—è, –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ
- **Spam —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π**: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –º–æ–≥—É—Ç –ø–æ–ª—É—á–∞—Ç—å —Å–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ
  - *–†–µ—à–µ–Ω–∏–µ*: –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞, –Ω–∞—Å—Ç—Ä–æ–π–∫–∏, rate limiting
- **Realtime –Ω–∞–≥—Ä—É–∑–∫–∞**: –ú–Ω–æ–≥–æ –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–¥–ø–∏—Å–æ–∫
  - *–†–µ—à–µ–Ω–∏–µ*: –û—Ç–ø–∏—Å–∫–∞ –ø—Ä–∏ –Ω–µ–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏, –±–∞—Ç—á–∏–Ω–≥

### ‚úÖ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞
- üìà **Engagement**: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç—Å—è –ø—Ä–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è—Ö (+40% retention)
- üîî **–ê–∫—Ç—É–∞–ª—å–Ω–æ—Å—Ç—å**: Realtime —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –≤–∞–∂–Ω—ã—Ö —Å–æ–±—ã—Ç–∏—è—Ö
- ‚öôÔ∏è **–ö–æ–Ω—Ç—Ä–æ–ª—å**: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—é—Ç –ø–æ–¥ —Å–µ–±—è
- üìä **–ú–µ—Ç—Ä–∏–∫–∏**: –ú–æ–∂–Ω–æ –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å CTR —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

### üìä –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: üî¥ –í–´–°–û–ö–ò–ô
**ROI**: 9/10 | **–°–ª–æ–∂–Ω–æ—Å—Ç—å**: 6/10 | **–°—Ä–æ–∫**: 1-2 –Ω–µ–¥–µ–ª–∏

---

## 2. –ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π –ø–æ–∏—Å–∫

### üìù –û–ø–∏—Å–∞–Ω–∏–µ
–ü–æ–ª–Ω–æ—Ç–µ–∫—Å—Ç–æ–≤—ã–π –ø–æ–∏—Å–∫ —Å —Ñ–∏–ª—å—Ç—Ä–∞–º–∏, –∞–≤—Ç–æ–¥–æ–ø–æ–ª–Ω–µ–Ω–∏–µ–º –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–º–∏ –∑–∞–ø—Ä–æ—Å–∞–º–∏.

### üéØ –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
- ‚ö†Ô∏è –ë–∞–∑–æ–≤—ã–π –ø–æ–∏—Å–∫ –µ—Å—Ç—å (–ø–æ—Ö–æ–∂–µ —á–µ—Ä–µ–∑ `/search?q=`)
- ‚ùå –ù–µ—Ç –ø–æ–ª–Ω–æ—Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ –∏–Ω–¥–µ–∫—Å–∞ PostgreSQL
- ‚ùå –ù–µ—Ç —Ñ–∏–ª—å—Ç—Ä–æ–≤ (–ø–æ –¥–∞—Ç–µ, –∞–≤—Ç–æ—Ä—É, —Ç–µ–≥–∞–º)
- ‚ùå –ù–µ—Ç –∞–≤—Ç–æ–¥–æ–ø–æ–ª–Ω–µ–Ω–∏—è
- ‚ùå –ù–µ—Ç –∏—Å—Ç–æ—Ä–∏–∏ –ø–æ–∏—Å–∫–∞

### üí° –ß—Ç–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å

#### A. PostgreSQL Full-Text Search

**–°–æ–∑–¥–∞–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–æ–≤:**
```sql
-- –î–æ–±–∞–≤–ª—è–µ–º tsvector –∫–æ–ª–æ–Ω–∫–∏ –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞
ALTER TABLE posts 
ADD COLUMN search_vector tsvector
GENERATED ALWAYS AS (
  setweight(to_tsvector('russian', coalesce(title, '')), 'A') ||
  setweight(to_tsvector('russian', coalesce(content, '')), 'B')
) STORED;

-- –ò–Ω–¥–µ–∫—Å GIN –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞
CREATE INDEX posts_search_idx ON posts USING GIN (search_vector);

-- –¢—Ä–∏–≥–≥–µ—Ä –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏
CREATE TRIGGER posts_search_update
BEFORE INSERT OR UPDATE ON posts
FOR EACH ROW EXECUTE FUNCTION
tsvector_update_trigger(search_vector, 'pg_catalog.russian', title, content);
```

**RPC —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–∏—Å–∫–∞:**
```sql
CREATE OR REPLACE FUNCTION search_posts(
  search_query text,
  filter_tags text[] DEFAULT NULL,
  filter_author_id uuid DEFAULT NULL,
  date_from timestamptz DEFAULT NULL,
  date_to timestamptz DEFAULT NULL,
  sort_by text DEFAULT 'relevance', -- 'relevance', 'recent', 'popular'
  limit_count integer DEFAULT 20,
  offset_count integer DEFAULT 0
)
RETURNS TABLE (
  id uuid,
  title text,
  content text,
  author_id uuid,
  created_at timestamptz,
  views integer,
  likes integer,
  comment_count integer,
  rank real -- –†–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç—å –ø–æ–∏—Å–∫–∞
) AS $$
BEGIN
  RETURN QUERY
  SELECT 
    p.id,
    p.title,
    p.content,
    p.author_id,
    p.created_at,
    p.views,
    COALESCE(likes_count.count, 0)::integer as likes,
    COALESCE(comments_count.count, 0)::integer as comment_count,
    ts_rank(p.search_vector, plainto_tsquery('russian', search_query)) as rank
  FROM posts p
  LEFT JOIN (
    SELECT post_id, COUNT(*) as count
    FROM post_reactions
    WHERE reaction_type = 'like'
    GROUP BY post_id
  ) likes_count ON p.id = likes_count.post_id
  LEFT JOIN (
    SELECT post_id, COUNT(*) as count
    FROM comments
    GROUP BY post_id
  ) comments_count ON p.id = comments_count.post_id
  WHERE 
    -- –ü–æ–ª–Ω–æ—Ç–µ–∫—Å—Ç–æ–≤—ã–π –ø–æ–∏—Å–∫
    p.search_vector @@ plainto_tsquery('russian', search_query)
    -- –§–∏–ª—å—Ç—Ä –ø–æ –∞–≤—Ç–æ—Ä—É
    AND (filter_author_id IS NULL OR p.author_id = filter_author_id)
    -- –§–∏–ª—å—Ç—Ä –ø–æ –¥–∞—Ç–µ
    AND (date_from IS NULL OR p.created_at >= date_from)
    AND (date_to IS NULL OR p.created_at <= date_to)
    -- –§–∏–ª—å—Ç—Ä –ø–æ —Ç–µ–≥–∞–º
    AND (
      filter_tags IS NULL 
      OR p.id IN (
        SELECT pt.post_id 
        FROM post_tags pt
        JOIN tags t ON pt.tag_id = t.id
        WHERE t.name = ANY(filter_tags)
      )
    )
  ORDER BY
    CASE 
      WHEN sort_by = 'relevance' THEN rank
      WHEN sort_by = 'recent' THEN EXTRACT(EPOCH FROM p.created_at)
      WHEN sort_by = 'popular' THEN (p.views + likes_count.count * 10)
    END DESC
  LIMIT limit_count
  OFFSET offset_count;
END;
$$ LANGUAGE plpgsql;
```

#### B. UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

**–ü–æ–∏—Å–∫–æ–≤–∞—è —Å—Ç—Ä–æ–∫–∞ —Å –∞–≤—Ç–æ–¥–æ–ø–æ–ª–Ω–µ–Ω–∏–µ–º:**
```tsx
// components/search/search-input.tsx
import { useState, useEffect, useCallback } from 'react'
import { Command, CommandInput, CommandList, CommandItem } from '@/components/ui/command'
import { useDebounce } from '@/hooks/use-debounce'

export function SearchInput() {
  const [query, setQuery] = useState('')
  const [suggestions, setSuggestions] = useState([])
  const debouncedQuery = useDebounce(query, 300)
  
  useEffect(() => {
    if (debouncedQuery.length < 2) return
    
    // Fetch suggestions
    fetchSuggestions(debouncedQuery).then(setSuggestions)
  }, [debouncedQuery])
  
  return (
    <Command>
      <CommandInput 
        placeholder="–ü–æ–∏—Å–∫ –ø–æ—Å—Ç–æ–≤..." 
        value={query}
        onValueChange={setQuery}
      />
      <CommandList>
        {suggestions.map(item => (
          <CommandItem key={item.id} value={item.title}>
            {item.title}
          </CommandItem>
        ))}
      </CommandList>
    </Command>
  )
}
```

**–ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã:**
```tsx
// components/search/search-filters.tsx
interface SearchFilters {
  tags: string[]
  author: string | null
  dateRange: { from: Date; to: Date } | null
  sortBy: 'relevance' | 'recent' | 'popular'
}

export function SearchFilters({ filters, onChange }) {
  return (
    <div className="space-y-4">
      {/* –¢–µ–≥–∏ */}
      <MultiSelect
        label="–¢–µ–≥–∏"
        options={availableTags}
        value={filters.tags}
        onChange={(tags) => onChange({ ...filters, tags })}
      />
      
      {/* –ê–≤—Ç–æ—Ä */}
      <UserSelect
        label="–ê–≤—Ç–æ—Ä"
        value={filters.author}
        onChange={(author) => onChange({ ...filters, author })}
      />
      
      {/* –î–∞—Ç–∞ */}
      <DateRangePicker
        label="–ü–µ—Ä–∏–æ–¥"
        value={filters.dateRange}
        onChange={(dateRange) => onChange({ ...filters, dateRange })}
      />
      
      {/* –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ */}
      <Select
        label="–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞"
        options={[
          { value: 'relevance', label: '–ü–æ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç–∏' },
          { value: 'recent', label: '–°–Ω–∞—á–∞–ª–∞ –Ω–æ–≤—ã–µ' },
          { value: 'popular', label: '–ü–æ–ø—É–ª—è—Ä–Ω—ã–µ' }
        ]}
        value={filters.sortBy}
        onChange={(sortBy) => onChange({ ...filters, sortBy })}
      />
    </div>
  )
}
```

**–°—Ç—Ä–∞–Ω–∏—Ü–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤:**
```tsx
// app/search/page.tsx
export default async function SearchPage({ searchParams }) {
  const query = searchParams.q || ''
  const filters = parseFilters(searchParams)
  
  const results = await supabase.rpc('search_posts', {
    search_query: query,
    filter_tags: filters.tags,
    filter_author_id: filters.author,
    date_from: filters.dateFrom,
    date_to: filters.dateTo,
    sort_by: filters.sortBy,
    limit_count: 20
  })
  
  return (
    <div className="container mx-auto">
      <SearchFilters filters={filters} />
      <SearchResults results={results} query={query} />
    </div>
  )
}
```

#### C. –ò—Å—Ç–æ—Ä–∏—è –ø–æ–∏—Å–∫–∞

```typescript
// –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ localStorage –∏–ª–∏ —Ç–∞–±–ª–∏—Ü–µ
interface SearchHistory {
  id: string
  query: string
  filters: SearchFilters
  timestamp: Date
}

// –°–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –ø–æ–∏—Å–∫–∏
interface SavedSearch {
  id: string
  name: string
  query: string
  filters: SearchFilters
  notifications: boolean // –£–≤–µ–¥–æ–º–ª—è—Ç—å –æ –Ω–æ–≤—ã—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞—Ö
}
```

### üõ†Ô∏è –®–∞–≥–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

**–§–∞–∑–∞ 1: PostgreSQL FTS (2 –¥–Ω—è)**
```bash
1. –°–æ–∑–¥–∞—Ç—å tsvector –∫–æ–ª–æ–Ω–∫–∏
2. –î–æ–±–∞–≤–∏—Ç—å GIN –∏–Ω–¥–µ–∫—Å—ã
3. –°–æ–∑–¥–∞—Ç—å search_posts() —Ñ—É–Ω–∫—Ü–∏—é
4. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
```

**–§–∞–∑–∞ 2: –ë–∞–∑–æ–≤—ã–π –ø–æ–∏—Å–∫ (2-3 –¥–Ω—è)**
```bash
1. –û–±–Ω–æ–≤–∏—Ç—å SearchInput –∫–æ–º–ø–æ–Ω–µ–Ω—Ç
2. –°–æ–∑–¥–∞—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
3. –î–æ–±–∞–≤–∏—Ç—å –ø–æ–¥—Å–≤–µ—Ç–∫—É –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö —Å–ª–æ–≤
4. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ø–∞–≥–∏–Ω–∞—Ü–∏—é
```

**–§–∞–∑–∞ 3: –§–∏–ª—å—Ç—Ä—ã (2 –¥–Ω—è)**
```bash
1. –°–æ–∑–¥–∞—Ç—å SearchFilters –∫–æ–º–ø–æ–Ω–µ–Ω—Ç
2. –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å —Å RPC —Ñ—É–Ω–∫—Ü–∏–µ–π
3. URL query params –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–æ–≤
4. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Ñ–∏–ª—å—Ç—Ä–æ–≤
```

**–§–∞–∑–∞ 4: –ê–≤—Ç–æ–¥–æ–ø–æ–ª–Ω–µ–Ω–∏–µ (1-2 –¥–Ω—è)**
```bash
1. Debounced suggestions API
2. Command palette UI
3. –ò—Å—Ç–æ—Ä–∏—è –ø–æ–∏—Å–∫–∞
4. –ë—ã—Å—Ç—Ä—ã–µ —Å—Å—ã–ª–∫–∏ (—á–∞—Å—Ç–æ –∏—â—É—Ç)
```

**–§–∞–∑–∞ 5: –ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–µ —Ñ–∏—á–∏ (2-3 –¥–Ω—è)**
```bash
1. –°–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –ø–æ–∏—Å–∫–∏
2. –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –Ω–æ–≤—ã—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞—Ö
3. –ü–æ–∏—Å–∫ –ø–æ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è–º
4. –≠–∫—Å–ø–æ—Ä—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
```

### ‚ö†Ô∏è –†–∏—Å–∫–∏
- **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å FTS**: –ú–µ–¥–ª–µ–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –Ω–∞ –±–æ–ª—å—à–∏—Ö –¥–∞–Ω–Ω—ã—Ö
  - *–†–µ—à–µ–Ω–∏–µ*: –ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã, LIMIT, –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
- **–†–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç—å**: –ü–ª–æ—Ö–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ –ø–æ–∏—Å–∫–∞ –Ω–∞ —Ä—É—Å—Å–∫–æ–º
  - *–†–µ—à–µ–Ω–∏–µ*: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≤–µ—Å–æ–≤ (title > content), –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ 'russian' —Å–ª–æ–≤–∞—Ä—è
- **–°–ª–æ–∂–Ω–æ—Å—Ç—å —Ñ–∏–ª—å—Ç—Ä–æ–≤**: –ö–æ–º–±–∏–Ω–∞—Ü–∏–∏ –º–æ–≥—É—Ç –¥–∞–≤–∞—Ç—å –ø—É—Å—Ç—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
  - *–†–µ—à–µ–Ω–∏–µ*: –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ñ–∏–ª—å—Ç—Ä–∞

### ‚úÖ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞
- üîç **–ù–∞—Ö–æ–¥–∏–º–æ—Å—Ç—å**: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –Ω–∞—Ö–æ–¥—è—Ç –Ω—É–∂–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç (+50% engagement)
- ‚ö° **–°–∫–æ—Ä–æ—Å—Ç—å**: FTS –±—ã—Å—Ç—Ä–µ–µ —á–µ–º LIKE –∑–∞–ø—Ä–æ—Å—ã (100x+)
- üéØ **–¢–æ—á–Ω–æ—Å—Ç—å**: –†–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç—å —á–µ—Ä–µ–∑ ts_rank
- üìà **SEO**: –õ—É—á—à–∞—è –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞
- üíæ **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å**: –†–∞–±–æ—Ç–∞–µ—Ç —Å –º–∏–ª–ª–∏–æ–Ω–∞–º–∏ –ø–æ—Å—Ç–æ–≤

### üìä –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: üî¥ –í–´–°–û–ö–ò–ô
**ROI**: 10/10 | **–°–ª–æ–∂–Ω–æ—Å—Ç—å**: 7/10 | **–°—Ä–æ–∫**: 1-2 –Ω–µ–¥–µ–ª–∏

---

## 3. –ü—Ä–∏–≤–∞—Ç–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è

### üìù –û–ø–∏—Å–∞–Ω–∏–µ
–ü–æ–ª–Ω–æ—Ü–µ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –ª–∏—á–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π —Å realtime, —Ç–∏–ø–∏–∑–∞—Ü–∏–µ–π, –ø—Ä–∏–∫—Ä–µ–ø–ª–µ–Ω–∏–µ–º —Ñ–∞–π–ª–æ–≤.

### üéØ –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
- ‚úÖ –¢–∞–±–ª–∏—Ü—ã `conversations` –∏ `direct_messages` —Å—É—â–µ—Å—Ç–≤—É—é—Ç
- ‚ùå –ù–µ—Ç UI
- ‚ùå –ù–µ—Ç realtime –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π
- ‚ùå –ù–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –æ –Ω–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏—è—Ö

### üí° –ß—Ç–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å

#### A. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö

**–£–ª—É—á—à–µ–Ω–∏–µ —Å—Ö–µ–º—ã:**
```sql
-- –î–æ–±–∞–≤–ª—è–µ–º –ø–æ–ª—è –¥–ª—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏
ALTER TABLE conversations
ADD COLUMN last_message_at timestamptz DEFAULT NOW(),
ADD COLUMN last_message_preview text,
ADD COLUMN is_group boolean DEFAULT false,
ADD COLUMN group_name text,
ADD COLUMN group_avatar_url text;

ALTER TABLE direct_messages
ADD COLUMN edited_at timestamptz,
ADD COLUMN reply_to_id uuid REFERENCES direct_messages(id),
ADD COLUMN attachments jsonb, -- [{type: 'image', url: '...'}]
ADD COLUMN reactions jsonb; -- [{user_id: '...', emoji: 'üëç'}]

-- –ò–Ω–¥–µ–∫—Å—ã –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
CREATE INDEX idx_conversations_user ON conversations(user1_id, user2_id);
CREATE INDEX idx_messages_conversation ON direct_messages(conversation_id, created_at DESC);
CREATE INDEX idx_messages_unread ON direct_messages(receiver_id, is_read);

-- RPC –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å–ø–∏—Å–∫–∞ —á–∞—Ç–æ–≤
CREATE OR REPLACE FUNCTION get_user_conversations(
  p_user_id uuid,
  p_limit integer DEFAULT 20,
  p_offset integer DEFAULT 0
)
RETURNS TABLE (
  id uuid,
  other_user_id uuid,
  other_user_username text,
  other_user_avatar text,
  last_message text,
  last_message_at timestamptz,
  unread_count bigint,
  is_online boolean
) AS $$
BEGIN
  RETURN QUERY
  SELECT 
    c.id,
    CASE 
      WHEN c.user1_id = p_user_id THEN c.user2_id 
      ELSE c.user1_id 
    END as other_user_id,
    p.username as other_user_username,
    p.avatar_url as other_user_avatar,
    c.last_message_preview as last_message,
    c.last_message_at,
    COALESCE(unread.count, 0) as unread_count,
    (p.last_seen > NOW() - INTERVAL '5 minutes') as is_online
  FROM conversations c
  JOIN profiles p ON (
    CASE 
      WHEN c.user1_id = p_user_id THEN c.user2_id = p.id
      ELSE c.user1_id = p.id
    END
  )
  LEFT JOIN (
    SELECT conversation_id, COUNT(*) as count
    FROM direct_messages
    WHERE receiver_id = p_user_id AND is_read = false
    GROUP BY conversation_id
  ) unread ON unread.conversation_id = c.id
  WHERE c.user1_id = p_user_id OR c.user2_id = p_user_id
  ORDER BY c.last_message_at DESC
  LIMIT p_limit
  OFFSET p_offset;
END;
$$ LANGUAGE plpgsql;
```

#### B. UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

**–°–ø–∏—Å–æ–∫ —á–∞—Ç–æ–≤:**
```tsx
// app/messages/page.tsx
export default function MessagesPage() {
  return (
    <div className="flex h-[calc(100vh-4rem)]">
      {/* Sidebar —Å —á–∞—Ç–∞–º–∏ */}
      <div className="w-80 border-r">
        <ConversationsList />
      </div>
      
      {/* –û–±–ª–∞—Å—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–π */}
      <div className="flex-1">
        {selectedConversation ? (
          <MessageThread conversationId={selectedConversation} />
        ) : (
          <EmptyState />
        )}
      </div>
    </div>
  )
}
```

**–ö–æ–º–ø–æ–Ω–µ–Ω—Ç —á–∞—Ç–∞:**
```tsx
// components/messages/message-thread.tsx
export function MessageThread({ conversationId }) {
  const { messages, sendMessage, isLoading } = useMessages(conversationId)
  const { otherUser } = useConversation(conversationId)
  
  // Realtime subscription
  useEffect(() => {
    const subscription = supabase
      .channel(`conversation:${conversationId}`)
      .on('postgres_changes', {
        event: 'INSERT',
        schema: 'public',
        table: 'direct_messages',
        filter: `conversation_id=eq.${conversationId}`
      }, (payload) => {
        // –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
        addMessage(payload.new)
        // –û—Ç–º–µ—á–∞–µ–º –∫–∞–∫ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω–æ–µ
        markAsRead(payload.new.id)
      })
      .subscribe()
      
    return () => subscription.unsubscribe()
  }, [conversationId])
  
  return (
    <div className="flex flex-col h-full">
      {/* Header */}
      <div className="border-b p-4 flex items-center gap-3">
        <Avatar user={otherUser} />
        <div>
          <h2 className="font-semibold">{otherUser.display_name}</h2>
          <p className="text-sm text-muted-foreground">
            {otherUser.is_online ? '–í —Å–µ—Ç–∏' : '–ë—ã–ª –≤ —Å–µ—Ç–∏ –Ω–µ–¥–∞–≤–Ω–æ'}
          </p>
        </div>
      </div>
      
      {/* Messages */}
      <ScrollArea className="flex-1 p-4">
        {messages.map((message) => (
          <MessageBubble key={message.id} message={message} />
        ))}
      </ScrollArea>
      
      {/* Input */}
      <MessageInput onSend={sendMessage} />
    </div>
  )
}
```

**–°–æ–æ–±—â–µ–Ω–∏–µ:**
```tsx
// components/messages/message-bubble.tsx
export function MessageBubble({ message }) {
  const isOwn = message.sender_id === currentUserId
  const [isEditing, setIsEditing] = useState(false)
  
  return (
    <div className={cn(
      "flex gap-2 mb-4",
      isOwn && "flex-row-reverse"
    )}>
      <Avatar user={message.sender} size="sm" />
      
      <div className={cn(
        "max-w-[70%] rounded-lg p-3",
        isOwn 
          ? "bg-primary text-primary-foreground" 
          : "bg-muted"
      )}>
        {/* –û—Ç–≤–µ—Ç –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏–µ */}
        {message.reply_to && (
          <div className="mb-2 text-xs opacity-70 border-l-2 pl-2">
            {message.reply_to.content}
          </div>
        )}
        
        {/* –¢–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è */}
        {isEditing ? (
          <MessageEditForm 
            message={message} 
            onCancel={() => setIsEditing(false)}
          />
        ) : (
          <>
            <p className="whitespace-pre-wrap">{message.content}</p>
            
            {/* –í–ª–æ–∂–µ–Ω–∏—è */}
            {message.attachments && (
              <MessageAttachments files={message.attachments} />
            )}
            
            {/* –†–µ–∞–∫—Ü–∏–∏ */}
            {message.reactions && (
              <MessageReactions reactions={message.reactions} />
            )}
            
            {/* –í—Ä–µ–º—è –∏ —Å—Ç–∞—Ç—É—Å */}
            <div className="flex items-center gap-2 mt-1 text-xs opacity-70">
              <time>{formatTime(message.created_at)}</time>
              {message.edited_at && <span>(–∏–∑–º–µ–Ω–µ–Ω–æ)</span>}
              {isOwn && (
                message.is_read ? <CheckCheck /> : <Check />
              )}
            </div>
          </>
        )}
        
        {/* –ú–µ–Ω—é –¥–µ–π—Å—Ç–≤–∏–π */}
        <MessageActions 
          message={message}
          onEdit={() => setIsEditing(true)}
          onReply={() => {/* ... */}}
          onDelete={() => {/* ... */}}
        />
      </div>
    </div>
  )
}
```

**–ü–æ–ª–µ –≤–≤–æ–¥–∞:**
```tsx
// components/messages/message-input.tsx
export function MessageInput({ onSend, replyTo }) {
  const [content, setContent] = useState('')
  const [files, setFiles] = useState([])
  const [isUploading, setIsUploading] = useState(false)
  
  const handleSend = async () => {
    if (!content.trim() && files.length === 0) return
    
    let attachments = []
    
    // –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤
    if (files.length > 0) {
      setIsUploading(true)
      attachments = await uploadFiles(files)
      setIsUploading(false)
    }
    
    await onSend({
      content,
      attachments,
      reply_to_id: replyTo?.id
    })
    
    setContent('')
    setFiles([])
  }
  
  return (
    <div className="border-t p-4">
      {/* –û—Ç–≤–µ—Ç –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏–µ */}
      {replyTo && (
        <div className="mb-2 flex items-center justify-between bg-muted p-2 rounded">
          <div className="text-sm truncate">
            –û—Ç–≤–µ—Ç –Ω–∞: {replyTo.content}
          </div>
          <Button size="icon" variant="ghost" onClick={() => clearReply()}>
            <X className="h-4 w-4" />
          </Button>
        </div>
      )}
      
      {/* –ü—Ä–µ–≤—å—é —Ñ–∞–π–ª–æ–≤ */}
      {files.length > 0 && (
        <div className="mb-2 flex gap-2">
          {files.map((file, i) => (
            <FilePreview 
              key={i} 
              file={file}
              onRemove={() => removeFile(i)}
            />
          ))}
        </div>
      )}
      
      <div className="flex gap-2">
        {/* –ü—Ä–∏–∫—Ä–µ–ø–ª–µ–Ω–∏–µ —Ñ–∞–π–ª–æ–≤ */}
        <input
          type="file"
          ref={fileInputRef}
          multiple
          className="hidden"
          onChange={(e) => setFiles([...files, ...e.target.files])}
        />
        <Button 
          size="icon" 
          variant="ghost"
          onClick={() => fileInputRef.current?.click()}
        >
          <Paperclip className="h-4 w-4" />
        </Button>
        
        {/* –¢–µ–∫—Å—Ç–æ–≤–æ–µ –ø–æ–ª–µ */}
        <Textarea
          value={content}
          onChange={(e) => setContent(e.target.value)}
          placeholder="–ù–∞–ø–∏—Å–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ..."
          className="min-h-[40px] resize-none"
          onKeyDown={(e) => {
            if (e.key === 'Enter' && !e.shiftKey) {
              e.preventDefault()
              handleSend()
            }
          }}
        />
        
        {/* –û—Ç–ø—Ä–∞–≤–∫–∞ */}
        <Button 
          onClick={handleSend}
          disabled={isUploading || (!content.trim() && files.length === 0)}
        >
          {isUploading ? <Loader2 className="animate-spin" /> : <Send />}
        </Button>
      </div>
    </div>
  )
}
```

### üõ†Ô∏è –®–∞–≥–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

**–§–∞–∑–∞ 1: –ë–∞–∑–æ–≤—ã–π —á–∞—Ç (3-4 –¥–Ω—è)**
```bash
1. –û–±–Ω–æ–≤–∏—Ç—å —Å—Ö–µ–º—É –ë–î
2. –°–æ–∑–¥–∞—Ç—å RPC —Ñ—É–Ω–∫—Ü–∏–∏
3. –ë–∞–∑–æ–≤—ã–π UI —Å–ø–∏—Å–∫–∞ —á–∞—Ç–æ–≤
4. –ë–∞–∑–æ–≤—ã–π UI —Ç—Ä–µ–¥–∞ —Å–æ–æ–±—â–µ–Ω–∏–π
5. –û—Ç–ø—Ä–∞–≤–∫–∞/–ø–æ–ª—É—á–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π
```

**–§–∞–∑–∞ 2: Realtime (2 –¥–Ω—è)**
```bash
1. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å Realtime –¥–ª—è direct_messages
2. –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ –Ω–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
3. –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä "–ø–µ—á–∞—Ç–∞–µ—Ç..."
4. –°—Ç–∞—Ç—É—Å—ã –ø—Ä–æ—á–∏—Ç–∞–Ω–æ/–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–æ
```

**–§–∞–∑–∞ 3: –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ (3-4 –¥–Ω—è)**
```bash
1. –ü—Ä–∏–∫—Ä–µ–ø–ª–µ–Ω–∏–µ —Ñ–∞–π–ª–æ–≤ (–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è, –¥–æ–∫—É–º–µ–Ω—Ç—ã)
2. –û—Ç–≤–µ—Ç—ã –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏—è
3. –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π
4. –£–¥–∞–ª–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π
5. –†–µ–∞–∫—Ü–∏–∏ –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏—è
```

**–§–∞–∑–∞ 4: UX —É–ª—É—á—à–µ–Ω–∏—è (2-3 –¥–Ω—è)**
```bash
1. –ü–æ–∏—Å–∫ –ø–æ —Å–æ–æ–±—â–µ–Ω–∏—è–º
2. –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ø–æ –¥–∞—Ç–∞–º
3. –ê–≤—Ç–æ—Å–∫—Ä–æ–ª–ª –∫ –Ω–æ–≤—ã–º
4. –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –Ω–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏—è—Ö
5. Push notifications (PWA)
```

### ‚ö†Ô∏è –†–∏—Å–∫–∏
- **–ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ**: –ú–Ω–æ–≥–æ –∞–∫—Ç–∏–≤–Ω—ã—Ö Realtime –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π
  - *–†–µ—à–µ–Ω–∏–µ*: –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –Ω–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—Ç–∫—Ä—ã—Ç—ã—Ö —á–∞—Ç–æ–≤, lazy loading
- **–•—Ä–∞–Ω–µ–Ω–∏–µ —Ñ–∞–π–ª–æ–≤**: –ë–æ–ª—å—à–∏–µ –≤–ª–æ–∂–µ–Ω–∏—è –∑–∞–π–º—É—Ç –º–µ—Å—Ç–æ
  - *–†–µ—à–µ–Ω–∏–µ*: –õ–∏–º–∏—Ç—ã –Ω–∞ —Ä–∞–∑–º–µ—Ä, Supabase Storage, CDN
- **–ú–æ–¥–µ—Ä–∞—Ü–∏—è**: –ü—Ä–∏–≤–∞—Ç–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è —Å–ª–æ–∂–Ω–æ –º–æ–¥–µ—Ä–∏—Ä–æ–≤–∞—Ç—å
  - *–†–µ—à–µ–Ω–∏–µ*: –°–∏—Å—Ç–µ–º–∞ —Ä–µ–ø–æ—Ä—Ç–æ–≤, –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è

### ‚úÖ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞
- üí¨ **Engagement**: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –æ–±—â–∞—é—Ç—Å—è –º–µ–∂–¥—É —Å–æ–±–æ–π (+60% –≤—Ä–µ–º–µ–Ω–∏ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏)
- üîî **Retention**: –í–æ–∑–≤—Ä–∞—â–∞—é—Ç—Å—è —á—Ç–æ–±—ã –æ—Ç–≤–µ—Ç–∏—Ç—å –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏—è
- üë• **Community**: –£–∫—Ä–µ–ø–ª—è–µ—Ç —Å–≤—è–∑–∏ –º–µ–∂–¥—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
- üìà **–ú–æ–Ω–µ—Ç–∏–∑–∞—Ü–∏—è**: –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ø—Ä–µ–º–∏—É–º-—Ñ—É–Ω–∫—Ü–∏–∏ (–≥—Ä—É–ø–ø—ã, –±–æ–ª—å—à–µ –≤–ª–æ–∂–µ–Ω–∏–π)

### üìä –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: üü° –°–†–ï–î–ù–ò–ô
**ROI**: 8/10 | **–°–ª–æ–∂–Ω–æ—Å—Ç—å**: 8/10 | **–°—Ä–æ–∫**: 2-3 –Ω–µ–¥–µ–ª–∏

---

## 4. –ú–æ–¥–µ—Ä–∞—Ü–∏—è –∏ —Ä–µ–ø–æ—Ä—Ç—ã

### üìù –û–ø–∏—Å–∞–Ω–∏–µ
–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –º–æ–¥–µ—Ä–∞—Ü–∏–∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –∏ —Å–∏—Å—Ç–µ–º–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∂–∞–ª–æ–± –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.

### üéØ –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
- ‚úÖ –¢–∞–±–ª–∏—Ü–∞ `reports` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
- ‚ùå –ù–µ—Ç UI –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Ä–µ–ø–æ—Ä—Ç–æ–≤
- ‚ùå –ù–µ—Ç –ø–∞–Ω–µ–ª–∏ –º–æ–¥–µ—Ä–∞—Ç–æ—Ä–∞
- ‚ùå –ù–µ—Ç —Å–∏—Å—Ç–µ–º—ã –ø—Ä–∞–≤ (—Ä–æ–ª–∏ –º–æ–¥–µ—Ä–∞—Ç–æ—Ä–æ–≤)
- ‚ùå –ù–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –º–æ–¥–µ—Ä–∞—Ü–∏–∏

### üí° –ß—Ç–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å

#### A. –°–∏—Å—Ç–µ–º–∞ —Ä–æ–ª–µ–π

**–†–∞—Å—à–∏—Ä–µ–Ω–∏–µ profiles:**
```sql
-- –î–æ–±–∞–≤–ª—è–µ–º —Ä–æ–ª–∏
CREATE TYPE user_role AS ENUM ('user', 'moderator', 'admin');

ALTER TABLE profiles
ADD COLUMN role user_role DEFAULT 'user',
ADD COLUMN can_moderate boolean GENERATED ALWAYS AS (role IN ('moderator', 'admin')) STORED,
ADD COLUMN moderation_stats jsonb DEFAULT '{
  "reports_handled": 0,
  "bans_issued": 0,
  "warnings_issued": 0
}'::jsonb;

-- –¢–∞–±–ª–∏—Ü–∞ –±–∞–Ω–æ–≤
CREATE TABLE user_bans (
  id uuid PRIMARY KEY DEFAULT uuid_generate_v4(),
  user_id uuid REFERENCES profiles(id) ON DELETE CASCADE,
  moderator_id uuid REFERENCES profiles(id),
  reason text NOT NULL,
  duration interval, -- NULL = permanent
  expires_at timestamptz,
  created_at timestamptz DEFAULT NOW(),
  is_active boolean DEFAULT true
);

-- –¢–∞–±–ª–∏—Ü–∞ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–π
CREATE TABLE user_warnings (
  id uuid PRIMARY KEY DEFAULT uuid_generate_v4(),
  user_id uuid REFERENCES profiles(id) ON DELETE CASCADE,
  moderator_id uuid REFERENCES profiles(id),
  reason text NOT NULL,
  severity text CHECK (severity IN ('low', 'medium', 'high')),
  created_at timestamptz DEFAULT NOW()
);

-- RLS –¥–ª—è –º–æ–¥–µ—Ä–∞—Ç–æ—Ä–æ–≤
CREATE POLICY "Moderators can view all reports"
ON reports FOR SELECT
TO authenticated
USING (
  EXISTS (
    SELECT 1 FROM profiles
    WHERE id = auth.uid() AND can_moderate = true
  )
);
```

#### B. UI –¥–ª—è —Ä–µ–ø–æ—Ä—Ç–æ–≤

**–ö–Ω–æ–ø–∫–∞ —Ä–µ–ø–æ—Ä—Ç–∞:**
```tsx
// components/moderation/report-button.tsx
export function ReportButton({ 
  type, // 'post' | 'comment' | 'user'
  targetId 
}) {
  const [isOpen, setIsOpen] = useState(false)
  
  return (
    <>
      <DropdownMenuItem onClick={() => setIsOpen(true)}>
        <Flag className="h-4 w-4 mr-2" />
        –ü–æ–∂–∞–ª–æ–≤–∞—Ç—å—Å—è
      </DropdownMenuItem>
      
      <ReportDialog
        open={isOpen}
        onClose={() => setIsOpen(false)}
        type={type}
        targetId={targetId}
      />
    </>
  )
}
```

**–î–∏–∞–ª–æ–≥ —Ä–µ–ø–æ—Ä—Ç–∞:**
```tsx
// components/moderation/report-dialog.tsx
const REPORT_REASONS = [
  { value: 'spam', label: '–°–ø–∞–º –∏–ª–∏ —Ä–µ–∫–ª–∞–º–∞' },
  { value: 'harassment', label: '–û—Å–∫–æ—Ä–±–ª–µ–Ω–∏—è –∏–ª–∏ —Ç—Ä–∞–≤–ª—è' },
  { value: 'violence', label: '–ù–∞—Å–∏–ª–∏–µ –∏–ª–∏ —É–≥—Ä–æ–∑—ã' },
  { value: 'hate_speech', label: 'Hate speech' },
  { value: 'nsfw', label: 'NSFW –∫–æ–Ω—Ç–µ–Ω—Ç' },
  { value: 'misinformation', label: '–î–µ–∑–∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è' },
  { value: 'copyright', label: '–ù–∞—Ä—É—à–µ–Ω–∏–µ –∞–≤—Ç–æ—Ä—Å–∫–∏—Ö –ø—Ä–∞–≤' },
  { value: 'other', label: '–î—Ä—É–≥–æ–µ' }
]

export function ReportDialog({ open, onClose, type, targetId }) {
  const [reason, setReason] = useState('')
  const [description, setDescription] = useState('')
  const [isSubmitting, setIsSubmitting] = useState(false)
  
  const handleSubmit = async () => {
    setIsSubmitting(true)
    
    const supabase = createClient()
    const { error } = await supabase
      .from('reports')
      .insert({
        content_type: type,
        content_id: targetId,
        reason,
        description,
        reporter_id: (await supabase.auth.getUser()).data.user?.id
      })
      
    if (error) {
      toast.error('–ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –∂–∞–ª–æ–±—É')
    } else {
      toast.success('–ñ–∞–ª–æ–±–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞. –ú—ã —Ä–∞—Å—Å–º–æ—Ç—Ä–∏–º –µ—ë –≤ –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è.')
      onClose()
    }
    
    setIsSubmitting(false)
  }
  
  return (
    <Dialog open={open} onOpenChange={onClose}>
      <DialogContent>
        <DialogHeader>
          <DialogTitle>–ü–æ–∂–∞–ª–æ–≤–∞—Ç—å—Å—è</DialogTitle>
          <DialogDescription>
            –°–æ–æ–±—â–∏—Ç–µ –Ω–∞–º –æ –Ω–∞—Ä—É—à–µ–Ω–∏–∏ –ø—Ä–∞–≤–∏–ª —Å–æ–æ–±—â–µ—Å—Ç–≤–∞
          </DialogDescription>
        </DialogHeader>
        
        <div className="space-y-4">
          <div>
            <Label>–ü—Ä–∏—á–∏–Ω–∞</Label>
            <Select value={reason} onValueChange={setReason}>
              {REPORT_REASONS.map(r => (
                <SelectItem key={r.value} value={r.value}>
                  {r.label}
                </SelectItem>
              ))}
            </Select>
          </div>
          
          <div>
            <Label>–ü–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)</Label>
            <Textarea
              value={description}
              onChange={(e) => setDescription(e.target.value)}
              placeholder="–†–∞—Å—Å–∫–∞–∂–∏—Ç–µ –ø–æ–¥—Ä–æ–±–Ω–µ–µ –æ –ø—Ä–æ–±–ª–µ–º–µ..."
              rows={4}
            />
          </div>
        </div>
        
        <DialogFooter>
          <Button variant="outline" onClick={onClose}>
            –û—Ç–º–µ–Ω–∞
          </Button>
          <Button 
            onClick={handleSubmit}
            disabled={!reason || isSubmitting}
          >
            {isSubmitting ? '–û—Ç–ø—Ä–∞–≤–∫–∞...' : '–û—Ç–ø—Ä–∞–≤–∏—Ç—å'}
          </Button>
        </DialogFooter>
      </DialogContent>
    </Dialog>
  )
}
```

#### C. –ü–∞–Ω–µ–ª—å –º–æ–¥–µ—Ä–∞—Ç–æ—Ä–∞

**–°—Ç—Ä–∞–Ω–∏—Ü–∞ –º–æ–¥–µ—Ä–∞—Ü–∏–∏:**
```tsx
// app/moderation/page.tsx
export default async function ModerationPage() {
  // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞
  const user = await getCurrentUser()
  if (!user?.can_moderate) {
    redirect('/')
  }
  
  const { data: pendingReports } = await supabase
    .from('reports')
    .select(`
      *,
      reporter:reporter_id(username, avatar_url),
      content:content_id(*)
    `)
    .eq('status', 'pending')
    .order('created_at', { ascending: false })
    .limit(50)
  
  return (
    <div className="container mx-auto py-6">
      <h1 className="text-2xl font-bold mb-6">–ü–∞–Ω–µ–ª—å –º–æ–¥–µ—Ä–∞—Ç–æ—Ä–∞</h1>
      
      <Tabs defaultValue="reports">
        <TabsList>
          <TabsTrigger value="reports">
            –ñ–∞–ª–æ–±—ã ({pendingReports?.length || 0})
          </TabsTrigger>
          <TabsTrigger value="users">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</TabsTrigger>
          <TabsTrigger value="content">–ö–æ–Ω—Ç–µ–Ω—Ç</TabsTrigger>
          <TabsTrigger value="stats">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</TabsTrigger>
        </TabsList>
        
        <TabsContent value="reports">
          <ReportsQueue reports={pendingReports} />
        </TabsContent>
        
        <TabsContent value="users">
          <UsersManagement />
        </TabsContent>
        
        <TabsContent value="content">
          <ContentModeration />
        </TabsContent>
        
        <TabsContent value="stats">
          <ModerationStats />
        </TabsContent>
      </Tabs>
    </div>
  )
}
```

**–û—á–µ—Ä–µ–¥—å —Ä–µ–ø–æ—Ä—Ç–æ–≤:**
```tsx
// components/moderation/reports-queue.tsx
export function ReportsQueue({ reports }) {
  const [selectedReport, setSelectedReport] = useState(null)
  
  return (
    <div className="grid grid-cols-2 gap-6">
      {/* –°–ø–∏—Å–æ–∫ —Ä–µ–ø–æ—Ä—Ç–æ–≤ */}
      <div className="space-y-2">
        {reports.map(report => (
          <Card 
            key={report.id}
            className={cn(
              "cursor-pointer transition-colors hover:bg-accent",
              selectedReport?.id === report.id && "ring-2 ring-primary"
            )}
            onClick={() => setSelectedReport(report)}
          >
            <CardContent className="p-4">
              <div className="flex items-start justify-between">
                <div className="space-y-1">
                  <div className="flex items-center gap-2">
                    <Badge variant={getSeverityVariant(report.reason)}>
                      {REPORT_REASONS[report.reason]}
                    </Badge>
                    <span className="text-sm text-muted-foreground">
                      {report.content_type}
                    </span>
                  </div>
                  
                  <p className="text-sm">
                    –û—Ç: {report.reporter.username}
                  </p>
                  
                  <p className="text-xs text-muted-foreground">
                    {formatDistanceToNow(report.created_at)} –Ω–∞–∑–∞–¥
                  </p>
                </div>
                
                <ReportStatusBadge status={report.status} />
              </div>
            </CardContent>
          </Card>
        ))}
      </div>
      
      {/* –î–µ—Ç–∞–ª–∏ —Ä–µ–ø–æ—Ä—Ç–∞ */}
      <div className="sticky top-6">
        {selectedReport ? (
          <ReportDetails 
            report={selectedReport}
            onAction={(action) => handleModerationAction(selectedReport, action)}
          />
        ) : (
          <Card>
            <CardContent className="p-12 text-center text-muted-foreground">
              –í—ã–±–µ—Ä–∏—Ç–µ –∂–∞–ª–æ–±—É –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞
            </CardContent>
          </Card>
        )}
      </div>
    </div>
  )
}
```

**–î–µ—Ç–∞–ª–∏ —Ä–µ–ø–æ—Ä—Ç–∞:**
```tsx
// components/moderation/report-details.tsx
export function ReportDetails({ report, onAction }) {
  const [actionReason, setActionReason] = useState('')
  
  return (
    <Card>
      <CardHeader>
        <CardTitle>–î–µ—Ç–∞–ª–∏ –∂–∞–ª–æ–±—ã</CardTitle>
      </CardHeader>
      
      <CardContent className="space-y-6">
        {/* –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ä–µ–ø–æ—Ä—Ç–µ */}
        <div className="space-y-2">
          <div className="flex justify-between">
            <span className="text-sm text-muted-foreground">–ü—Ä–∏—á–∏–Ω–∞:</span>
            <span className="text-sm font-medium">
              {REPORT_REASONS[report.reason]}
            </span>
          </div>
          
          <div className="flex justify-between">
            <span className="text-sm text-muted-foreground">–û—Ç:</span>
            <span className="text-sm font-medium">
              {report.reporter.username}
            </span>
          </div>
          
          <div className="flex justify-between">
            <span className="text-sm text-muted-foreground">–ö–æ–≥–¥–∞:</span>
            <span className="text-sm font-medium">
              {format(report.created_at, 'dd.MM.yyyy HH:mm')}
            </span>
          </div>
        </div>
        
        {/* –û–ø–∏—Å–∞–Ω–∏–µ */}
        {report.description && (
          <div>
            <Label className="text-sm text-muted-foreground">
              –û–ø–∏—Å–∞–Ω–∏–µ:
            </Label>
            <p className="mt-1 text-sm">{report.description}</p>
          </div>
        )}
        
        <Separator />
        
        {/* –ö–æ–Ω—Ç–µ–Ω—Ç */}
        <div>
          <Label className="text-sm text-muted-foreground mb-2">
            –ö–æ–Ω—Ç–µ–Ω—Ç:
          </Label>
          <Card className="bg-muted/50">
            <CardContent className="p-4">
              <ContentPreview content={report.content} />
            </CardContent>
          </Card>
        </div>
        
        <Separator />
        
        {/* –î–µ–π—Å—Ç–≤–∏—è –º–æ–¥–µ—Ä–∞—Ç–æ—Ä–∞ */}
        <div className="space-y-4">
          <Label>–î–µ–π—Å—Ç–≤–∏–µ –º–æ–¥–µ—Ä–∞—Ç–æ—Ä–∞:</Label>
          
          <Textarea
            placeholder="–ü—Ä–∏—á–∏–Ω–∞ –¥–µ–π—Å—Ç–≤–∏—è (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)..."
            value={actionReason}
            onChange={(e) => setActionReason(e.target.value)}
            rows={3}
          />
          
          <div className="flex gap-2">
            <Button
              variant="destructive"
              onClick={() => onAction({ type: 'ban', reason: actionReason })}
              disabled={!actionReason}
            >
              <Ban className="h-4 w-4 mr-2" />
              –ó–∞–±–∞–Ω–∏—Ç—å
            </Button>
            
            <Button
              variant="outline"
              onClick={() => onAction({ type: 'warn', reason: actionReason })}
              disabled={!actionReason}
            >
              <AlertTriangle className="h-4 w-4 mr-2" />
              –ü—Ä–µ–¥—É–ø—Ä–µ–¥–∏—Ç—å
            </Button>
            
            <Button
              variant="outline"
              onClick={() => onAction({ type: 'remove', reason: actionReason })}
              disabled={!actionReason}
            >
              <Trash className="h-4 w-4 mr-2" />
              –£–¥–∞–ª–∏—Ç—å –∫–æ–Ω—Ç–µ–Ω—Ç
            </Button>
          </div>
          
          <div className="flex gap-2">
            <Button
              variant="ghost"
              className="flex-1"
              onClick={() => onAction({ type: 'dismiss', reason: actionReason })}
            >
              –û—Ç–∫–ª–æ–Ω–∏—Ç—å –∂–∞–ª–æ–±—É
            </Button>
            
            <Button
              variant="ghost"
              className="flex-1"
              onClick={() => onAction({ type: 'escalate' })}
            >
              –≠—Å–∫–∞–ª–∏—Ä–æ–≤–∞—Ç—å
            </Button>
          </div>
        </div>
      </CardContent>
    </Card>
  )
}
```

#### D. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –º–æ–¥–µ—Ä–∞—Ü–∏—è

**–§–∏–ª—å—Ç—Ä –ø–ª–æ—Ö–∏—Ö —Å–ª–æ–≤:**
```typescript
// lib/moderation/content-filter.ts
const BAD_WORDS = [
  // –°–ø–∏—Å–æ–∫ –∑–∞–ø—Ä–µ—â–µ–Ω–Ω—ã—Ö —Å–ª–æ–≤
]

export function containsBadWords(text: string): boolean {
  const normalized = text.toLowerCase()
  return BAD_WORDS.some(word => normalized.includes(word))
}

export function filterContent(text: string): string {
  let filtered = text
  BAD_WORDS.forEach(word => {
    const regex = new RegExp(word, 'gi')
    filtered = filtered.replace(regex, '*'.repeat(word.length))
  })
  return filtered
}
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –ø–æ—Å—Ç–∞:**
```typescript
// app/api/posts/create/route.ts
export async function POST(req: Request) {
  const { title, content } = await req.json()
  
  // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –º–æ–¥–µ—Ä–∞—Ü–∏—è
  const needsReview = 
    containsBadWords(title) || 
    containsBadWords(content) ||
    content.length < 10 || // –°–ª–∏—à–∫–æ–º –∫–æ—Ä–æ—Ç–∫–∏–π
    hasSpamPatterns(content) // –ü–∞—Ç—Ç–µ—Ä–Ω—ã —Å–ø–∞–º–∞
  
  const { data, error } = await supabase
    .from('posts')
    .insert({
      title,
      content,
      author_id: user.id,
      status: needsReview ? 'pending_review' : 'published'
    })
  
  if (needsReview) {
    // –°–æ–∑–¥–∞–µ–º –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–µ–ø–æ—Ä—Ç
    await supabase.from('reports').insert({
      content_type: 'post',
      content_id: data.id,
      reason: 'auto_flagged',
      description: '–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–º–µ—á–µ–Ω–æ —Å–∏—Å—Ç–µ–º–æ–π',
      reporter_id: null // –°–∏—Å—Ç–µ–º–Ω—ã–π —Ä–µ–ø–æ—Ä—Ç
    })
  }
  
  return Response.json({ data })
}
```

### üõ†Ô∏è –®–∞–≥–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

**–§–∞–∑–∞ 1: –°–∏—Å—Ç–µ–º–∞ —Ä–µ–ø–æ—Ä—Ç–æ–≤ (2-3 –¥–Ω—è)**
```bash
1. –û–±–Ω–æ–≤–∏—Ç—å —Å—Ö–µ–º—É –ë–î (—Ä–æ–ª–∏, –±–∞–Ω—ã, warnings)
2. –°–æ–∑–¥–∞—Ç—å ReportButton –∫–æ–º–ø–æ–Ω–µ–Ω—Ç
3. –°–æ–∑–¥–∞—Ç—å ReportDialog –∫–æ–º–ø–æ–Ω–µ–Ω—Ç
4. –î–æ–±–∞–≤–∏—Ç—å –∫–Ω–æ–ø–∫–∏ —Ä–µ–ø–æ—Ä—Ç–∞ –≤ –ø–æ—Å—Ç—ã/–∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏
5. API –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Ä–µ–ø–æ—Ä—Ç–æ–≤
```

**–§–∞–∑–∞ 2: –ü–∞–Ω–µ–ª—å –º–æ–¥–µ—Ä–∞—Ç–æ—Ä–∞ (3-4 –¥–Ω—è)**
```bash
1. –°—Ç—Ä–∞–Ω–∏—Ü–∞ /moderation —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π –ø—Ä–∞–≤
2. ReportsQueue –∫–æ–º–ø–æ–Ω–µ–Ω—Ç
3. ReportDetails –∫–æ–º–ø–æ–Ω–µ–Ω—Ç
4. –î–µ–π—Å—Ç–≤–∏—è –º–æ–¥–µ—Ä–∞—Ç–æ—Ä–∞ (–±–∞–Ω, –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ, —É–¥–∞–ª–µ–Ω–∏–µ)
5. –ò—Å—Ç–æ—Ä–∏—è –¥–µ–π—Å—Ç–≤–∏–π
```

**–§–∞–∑–∞ 3: –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ (2 –¥–Ω—è)**
```bash
1. –°–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å —Ñ–∏–ª—å—Ç—Ä–∞–º–∏
2. –ü—Ä–æ—Ñ–∏–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (–º–æ–¥–µ—Ä–∞—Ç–æ—Ä—Å–∫–∏–π –≤–∏–¥)
3. –ò—Å—Ç–æ—Ä–∏—è –Ω–∞—Ä—É—à–µ–Ω–∏–π
4. –í—Ä–µ–º–µ–Ω–Ω—ã–µ –∏ –ø–æ—Å—Ç–æ—è–Ω–Ω—ã–µ –±–∞–Ω—ã
```

**–§–∞–∑–∞ 4: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –º–æ–¥–µ—Ä–∞—Ü–∏—è (2-3 –¥–Ω—è)**
```bash
1. –§–∏–ª—å—Ç—Ä –ø–ª–æ—Ö–∏—Ö —Å–ª–æ–≤
2. –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å–ø–∞–º–∞
3. Rate limiting –Ω–∞ –¥–µ–π—Å—Ç–≤–∏—è
4. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ä–µ–ø–æ—Ä—Ç—ã
```

**–§–∞–∑–∞ 5: –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏ —É–ª—É—á—à–µ–Ω–∏—è (2 –¥–Ω—è)**
```bash
1. –î–∞—à–±–æ—Ä–¥ —Å–æ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ–π
2. –≠–∫—Å–ø–æ—Ä—Ç –æ—Ç—á–µ—Ç–æ–≤
3. –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –º–æ–¥–µ—Ä–∞—Ç–æ—Ä–æ–≤
4. –õ–æ–≥–∏ –¥–µ–π—Å—Ç–≤–∏–π
```

### ‚ö†Ô∏è –†–∏—Å–∫–∏
- **–õ–æ–∂–Ω—ã–µ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏—è**: –ê–≤—Ç–æ–º–æ–¥–µ—Ä–∞—Ü–∏—è –º–æ–∂–µ—Ç –±–∞–Ω–∏—Ç—å –Ω–µ–≤–∏–Ω–Ω—ã—Ö
  - *–†–µ—à–µ–Ω–∏–µ*: –ê–ø–µ–ª–ª—è—Ü–∏–∏, —Ä—É—á–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤–∞–∂–Ω—ã—Ö —Å–ª—É—á–∞–µ–≤
- **–ù–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ –º–æ–¥–µ—Ä–∞—Ç–æ—Ä–æ–≤**: –ú–Ω–æ–≥–æ —Ä–µ–ø–æ—Ä—Ç–æ–≤
  - *–†–µ—à–µ–Ω–∏–µ*: –ü—Ä–∏–æ—Ä–∏—Ç–∏–∑–∞—Ü–∏—è, –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø—Ä–æ—Å—Ç—ã—Ö —Å–ª—É—á–∞–µ–≤
- **–ó–ª–æ—É–ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ**: –ú–∞—Å—Å–æ–≤—ã–µ –ª–æ–∂–Ω—ã–µ —Ä–µ–ø–æ—Ä—Ç—ã
  - *–†–µ—à–µ–Ω–∏–µ*: –õ–∏–º–∏—Ç—ã –Ω–∞ —Ä–µ–ø–æ—Ä—Ç—ã, —Ä–µ–ø—É—Ç–∞—Ü–∏—è —Ä–µ–ø–æ—Ä—Ç–µ—Ä–æ–≤

### ‚úÖ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞
- üõ°Ô∏è **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**: –ß–∏—Å—Ç–æ–µ —Å–æ–æ–±—â–µ—Å—Ç–≤–æ –±–µ–∑ —Ç–æ–∫—Å–∏—á–Ω–æ—Å—Ç–∏
- ‚öñÔ∏è **–°–ø—Ä–∞–≤–µ–¥–ª–∏–≤–æ—Å—Ç—å**: –ü—Ä–æ–∑—Ä–∞—á–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –º–æ–¥–µ—Ä–∞—Ü–∏–∏
- ü§ñ **–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è**: 70-80% —Å–ª—É—á–∞–µ–≤ —Ä–µ—à–∞—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
- üìä **–ö–æ–Ω—Ç—Ä–æ–ª—å**: –ü–æ–ª–Ω–∞—è –≤–∏–¥–∏–º–æ—Å—Ç—å –ø—Ä–æ–±–ª–µ–º–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
- üíº **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å**: –°–∏—Å—Ç–µ–º–∞ —Ä–∞—Å—Ç–µ—Ç –≤–º–µ—Å—Ç–µ —Å —Å–æ–æ–±—â–µ—Å—Ç–≤–æ–º

### üìä –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: üî¥ –í–´–°–û–ö–ò–ô (–¥–ª—è –ø—É–±–ª–∏—á–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞)
**ROI**: 9/10 | **–°–ª–æ–∂–Ω–æ—Å—Ç—å**: 7/10 | **–°—Ä–æ–∫**: 2-3 –Ω–µ–¥–µ–ª–∏

---

## 5. –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –¥–ª—è –∞–≤—Ç–æ—Ä–æ–≤

### üìù –û–ø–∏—Å–∞–Ω–∏–µ
–ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π –¥–∞—à–±–æ—Ä–¥ —Å –º–µ—Ç—Ä–∏–∫–∞–º–∏ –ø–æ—Å—Ç–æ–≤, –∞—É–¥–∏—Ç–æ—Ä–∏–∏ –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è–º–∏.

### üéØ –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
- ‚úÖ –ë–∞–∑–æ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏ –µ—Å—Ç—å (views, likes, comments)
- ‚ùå –ù–µ—Ç –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω–æ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
- ‚ùå –ù–µ—Ç –≥—Ä–∞—Ñ–∏–∫–æ–≤ –∏ —Ç—Ä–µ–Ω–¥–æ–≤
- ‚ùå –ù–µ—Ç –∏–Ω—Å–∞–π—Ç–æ–≤ –¥–ª—è –∞–≤—Ç–æ—Ä–æ–≤

### üí° –ß—Ç–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å

#### A. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö

**–¢–∞–±–ª–∏—Ü–∞ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏:**
```sql
CREATE TABLE author_analytics (
  id uuid PRIMARY KEY DEFAULT uuid_generate_v4(),
  author_id uuid REFERENCES profiles(id) ON DELETE CASCADE,
  date date NOT NULL,
  
  -- –ú–µ—Ç—Ä–∏–∫–∏ –ø–æ—Å—Ç–æ–≤
  posts_created integer DEFAULT 0,
  total_views integer DEFAULT 0,
  total_likes integer DEFAULT 0,
  total_dislikes integer DEFAULT 0,
  total_comments integer DEFAULT 0,
  total_bookmarks integer DEFAULT 0,
  
  -- –ú–µ—Ç—Ä–∏–∫–∏ –∞—É–¥–∏—Ç–æ—Ä–∏–∏
  new_followers integer DEFAULT 0,
  unfollows integer DEFAULT 0,
  profile_views integer DEFAULT 0,
  
  -- Engagement –º–µ—Ç—Ä–∏–∫–∏
  avg_engagement_rate numeric(5,2), -- (likes + comments) / views * 100
  best_post_id uuid REFERENCES posts(id),
  
  UNIQUE(author_id, date)
);

-- –ò–Ω–¥–µ–∫—Å—ã
CREATE INDEX idx_analytics_author_date ON author_analytics(author_id, date DESC);

-- –ú–∞—Ç–µ—Ä–∏–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞
CREATE MATERIALIZED VIEW author_stats_summary AS
SELECT 
  author_id,
  SUM(total_views) as total_views,
  SUM(total_likes) as total_likes,
  SUM(total_comments) as total_comments,
  SUM(posts_created) as posts_created,
  AVG(avg_engagement_rate) as avg_engagement_rate,
  COUNT(DISTINCT date) as days_active
FROM author_analytics
GROUP BY author_id;

CREATE UNIQUE INDEX idx_author_stats_summary ON author_stats_summary(author_id);

-- –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ (–≤—ã–∑—ã–≤–∞—Ç—å —á–µ—Ä–µ–∑ cron)
CREATE OR REPLACE FUNCTION update_author_analytics(p_date date DEFAULT CURRENT_DATE)
RETURNS void AS $$
BEGIN
  INSERT INTO author_analytics (
    author_id, 
    date,
    posts_created,
    total_views,
    total_likes,
    total_dislikes,
    total_comments,
    total_bookmarks,
    avg_engagement_rate
  )
  SELECT 
    p.author_id,
    p_date,
    COUNT(*) as posts_created,
    SUM(p.views) as total_views,
    SUM(COALESCE(likes.count, 0)) as total_likes,
    SUM(COALESCE(dislikes.count, 0)) as total_dislikes,
    SUM(COALESCE(comments.count, 0)) as total_comments,
    SUM(COALESCE(bookmarks.count, 0)) as total_bookmarks,
    AVG(
      CASE 
        WHEN p.views > 0 
        THEN ((COALESCE(likes.count, 0) + COALESCE(comments.count, 0)) / p.views::numeric * 100)
        ELSE 0
      END
    ) as avg_engagement_rate
  FROM posts p
  LEFT JOIN (
    SELECT post_id, COUNT(*) as count
    FROM post_reactions
    WHERE reaction_type = 'like' AND DATE(created_at) = p_date
    GROUP BY post_id
  ) likes ON p.id = likes.post_id
  LEFT JOIN (
    SELECT post_id, COUNT(*) as count
    FROM post_reactions
    WHERE reaction_type = 'dislike' AND DATE(created_at) = p_date
    GROUP BY post_id
  ) dislikes ON p.id = dislikes.post_id
  LEFT JOIN (
    SELECT post_id, COUNT(*) as count
    FROM comments
    WHERE DATE(created_at) = p_date
    GROUP BY post_id
  ) comments ON p.id = comments.post_id
  LEFT JOIN (
    SELECT post_id, COUNT(*) as count
    FROM bookmarks
    WHERE DATE(created_at) = p_date
    GROUP BY post_id
  ) bookmarks ON p.id = bookmarks.post_id
  WHERE DATE(p.created_at) = p_date
  GROUP BY p.author_id
  ON CONFLICT (author_id, date) 
  DO UPDATE SET
    posts_created = EXCLUDED.posts_created,
    total_views = EXCLUDED.total_views,
    total_likes = EXCLUDED.total_likes,
    total_dislikes = EXCLUDED.total_dislikes,
    total_comments = EXCLUDED.total_comments,
    total_bookmarks = EXCLUDED.total_bookmarks,
    avg_engagement_rate = EXCLUDED.avg_engagement_rate;
    
  -- –û–±–Ω–æ–≤–ª—è–µ–º –º–∞—Ç–µ—Ä–∏–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ
  REFRESH MATERIALIZED VIEW CONCURRENTLY author_stats_summary;
END;
$$ LANGUAGE plpgsql;
```

#### B. Dashboard UI

**–°—Ç—Ä–∞–Ω–∏—Ü–∞ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏:**
```tsx
// app/analytics/page.tsx
export default async function AnalyticsPage() {
  const user = await getCurrentUser()
  if (!user) redirect('/auth/login')
  
  // –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 30 –¥–Ω–µ–π
  const { data: analytics } = await supabase
    .from('author_analytics')
    .select('*')
    .eq('author_id', user.id)
    .gte('date', subDays(new Date(), 30))
    .order('date', { ascending: true })
  
  // –ü–æ–ª—É—á–∞–µ–º —Å–≤–æ–¥–∫—É
  const { data: summary } = await supabase
    .from('author_stats_summary')
    .select('*')
    .eq('author_id', user.id)
    .single()
  
  // –¢–æ–ø –ø–æ—Å—Ç—ã
  const { data: topPosts } = await supabase
    .from('posts')
    .select('id, title, views, likes, comment_count')
    .eq('author_id', user.id)
    .order('views', { ascending: false })
    .limit(5)
  
  return (
    <div className="container mx-auto py-8">
      <h1 className="text-3xl font-bold mb-8">–ê–Ω–∞–ª–∏—Ç–∏–∫–∞</h1>
      
      {/* –ö–∞—Ä—Ç–æ—á–∫–∏ —Å –º–µ—Ç—Ä–∏–∫–∞–º–∏ */}
      <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
        <MetricCard
          title="–ü—Ä–æ—Å–º–æ—Ç—Ä—ã"
          value={summary.total_views}
          icon={<Eye />}
          trend={calculateTrend(analytics, 'total_views')}
        />
        <MetricCard
          title="–õ–∞–π–∫–∏"
          value={summary.total_likes}
          icon={<ThumbsUp />}
          trend={calculateTrend(analytics, 'total_likes')}
        />
        <MetricCard
          title="–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏"
          value={summary.total_comments}
          icon={<MessageSquare />}
          trend={calculateTrend(analytics, 'total_comments')}
        />
        <MetricCard
          title="Engagement"
          value={`${summary.avg_engagement_rate.toFixed(1)}%`}
          icon={<TrendingUp />}
          trend={calculateTrend(analytics, 'avg_engagement_rate')}
        />
      </div>
      
      {/* –ì—Ä–∞—Ñ–∏–∫–∏ */}
      <div className="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
        <Card>
          <CardHeader>
            <CardTitle>–ü—Ä–æ—Å–º–æ—Ç—Ä—ã –∑–∞ 30 –¥–Ω–µ–π</CardTitle>
          </CardHeader>
          <CardContent>
            <ViewsChart data={analytics} />
          </CardContent>
        </Card>
        
        <Card>
          <CardHeader>
            <CardTitle>Engagement</CardTitle>
          </CardHeader>
          <CardContent>
            <EngagementChart data={analytics} />
          </CardContent>
        </Card>
      </div>
      
      {/* –¢–æ–ø –ø–æ—Å—Ç—ã */}
      <Card>
        <CardHeader>
          <CardTitle>–õ—É—á—à–∏–µ –ø–æ—Å—Ç—ã</CardTitle>
          <CardDescription>–ü–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤</CardDescription>
        </CardHeader>
        <CardContent>
          <TopPostsList posts={topPosts} />
        </CardContent>
      </Card>
      
      {/* –ò–Ω—Å–∞–π—Ç—ã */}
      <Card className="mt-6">
        <CardHeader>
          <CardTitle>–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏</CardTitle>
        </CardHeader>
        <CardContent>
          <InsightsList insights={generateInsights(analytics, summary)} />
        </CardContent>
      </Card>
    </div>
  )
}
```

**–ú–µ—Ç—Ä–∏–∫–∞ –∫–∞—Ä—Ç–æ—á–∫–∞:**
```tsx
// components/analytics/metric-card.tsx
export function MetricCard({ title, value, icon, trend }) {
  const isPositive = trend > 0
  
  return (
    <Card>
      <CardContent className="pt-6">
        <div className="flex items-center justify-between mb-2">
          <span className="text-sm text-muted-foreground">{title}</span>
          <div className="p-2 bg-primary/10 rounded-lg">
            {icon}
          </div>
        </div>
        
        <div className="text-2xl font-bold mb-1">
          {typeof value === 'number' ? value.toLocaleString() : value}
        </div>
        
        {trend !== null && (
          <div className={cn(
            "flex items-center gap-1 text-xs",
            isPositive ? "text-green-600" : "text-red-600"
          )}>
            {isPositive ? <TrendingUp className="h-3 w-3" /> : <TrendingDown className="h-3 w-3" />}
            <span>{Math.abs(trend)}% –∑–∞ –Ω–µ–¥–µ–ª—é</span>
          </div>
        )}
      </CardContent>
    </Card>
  )
}
```

**–ì—Ä–∞—Ñ–∏–∫ –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤:**
```tsx
// components/analytics/views-chart.tsx
import { LineChart, Line, XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer } from 'recharts'

export function ViewsChart({ data }) {
  const chartData = data.map(d => ({
    date: format(parseISO(d.date), 'dd MMM'),
    views: d.total_views,
    engagement: d.avg_engagement_rate
  }))
  
  return (
    <ResponsiveContainer width="100%" height={300}>
      <LineChart data={chartData}>
        <CartesianGrid strokeDasharray="3 3" />
        <XAxis dataKey="date" />
        <YAxis />
        <Tooltip />
        <Line 
          type="monotone" 
          dataKey="views" 
          stroke="hsl(var(--primary))" 
          strokeWidth={2}
        />
      </LineChart>
    </ResponsiveContainer>
  )
}
```

**–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∏–Ω—Å–∞–π—Ç–æ–≤:**
```typescript
// lib/analytics/insights.ts
export function generateInsights(analytics, summary) {
  const insights = []
  
  // –ê–Ω–∞–ª–∏–∑ engagement rate
  if (summary.avg_engagement_rate < 5) {
    insights.push({
      type: 'warning',
      title: '–ù–∏–∑–∫–∏–π engagement',
      description: '–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –¥–æ–±–∞–≤–ª—è—Ç—å –±–æ–ª—å—à–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –∏ –∑–∞–¥–∞–≤–∞—Ç—å –≤–æ–ø—Ä–æ—Å—ã —á–∏—Ç–∞—Ç–µ–ª—è–º',
      priority: 'high'
    })
  }
  
  // –ê–Ω–∞–ª–∏–∑ —á–∞—Å—Ç–æ—Ç—ã –ø—É–±–ª–∏–∫–∞—Ü–∏–π
  const postsThisWeek = analytics
    .filter(d => isAfter(parseISO(d.date), subDays(new Date(), 7)))
    .reduce((sum, d) => sum + d.posts_created, 0)
  
  if (postsThisWeek === 0) {
    insights.push({
      type: 'info',
      title: '–î–∞–≤–Ω–æ –Ω–µ –±—ã–ª–æ –ø–æ—Å—Ç–æ–≤',
      description: '–†–µ–≥—É–ª—è—Ä–Ω—ã–µ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ –ø–æ–º–æ–≥–∞—é—Ç —É–¥–µ—Ä–∂–∏–≤–∞—Ç—å –∞—É–¥–∏—Ç–æ—Ä–∏—é. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å 2-3 —Ä–∞–∑–∞ –≤ –Ω–µ–¥–µ–ª—é.',
      priority: 'medium'
    })
  }
  
  // –õ—É—á—à–µ–µ –≤—Ä–µ–º—è –¥–ª—è –ø—É–±–ª–∏–∫–∞—Ü–∏–∏
  const bestHour = findBestPostingHour(analytics)
  insights.push({
    type: 'tip',
    title: '–õ—É—á—à–µ–µ –≤—Ä–µ–º—è –¥–ª—è –ø—É–±–ª–∏–∫–∞—Ü–∏–∏',
    description: `–í–∞—à–∏ –ø–æ—Å—Ç—ã –ø–æ–ª—É—á–∞—é—Ç –±–æ–ª—å—à–µ –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤ –≤ ${bestHour}:00. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å –≤ —ç—Ç–æ –≤—Ä–µ–º—è.`,
    priority: 'low'
  })
  
  // –¢–æ–ø —Ç–µ–≥–∏
  const topTags = findTopPerformingTags()
  if (topTags.length > 0) {
    insights.push({
      type: 'success',
      title: '–ü–æ–ø—É–ª—è—Ä–Ω—ã–µ —Ç–µ–º—ã',
      description: `–ü–æ—Å—Ç—ã —Å —Ç–µ–≥–∞–º–∏ ${topTags.join(', ')} –ø–æ–ª—É—á–∞—é—Ç –±–æ–ª—å—à–µ –≤—Å–µ–≥–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤`,
      priority: 'medium'
    })
  }
  
  return insights
}
```

### üõ†Ô∏è –®–∞–≥–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

**–§–∞–∑–∞ 1: –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö (2 –¥–Ω—è)**
```bash
1. –°–æ–∑–¥–∞—Ç—å author_analytics —Ç–∞–±–ª–∏—Ü—É
2. –°–æ–∑–¥–∞—Ç—å update_author_analytics() —Ñ—É–Ω–∫—Ü–∏—é
3. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å cron job (Supabase pg_cron)
4. –ó–∞–ø–æ–ª–Ω–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ
```

**–§–∞–∑–∞ 2: –ë–∞–∑–æ–≤—ã–π –¥–∞—à–±–æ—Ä–¥ (3 –¥–Ω—è)**
```bash
1. –°—Ç—Ä–∞–Ω–∏—Ü–∞ /analytics
2. –ö–∞—Ä—Ç–æ—á–∫–∏ —Å –º–µ—Ç—Ä–∏–∫–∞–º–∏
3. –¢–æ–ø –ø–æ—Å—Ç—ã —Å–ø–∏—Å–æ–∫
4. –≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö –≤ CSV
```

**–§–∞–∑–∞ 3: –ì—Ä–∞—Ñ–∏–∫–∏ (2-3 –¥–Ω—è)**
```bash
1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å recharts –∏–ª–∏ –¥—Ä—É–≥—É—é –±–∏–±–ª–∏–æ—Ç–µ–∫—É
2. –ì—Ä–∞—Ñ–∏–∫ –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤
3. –ì—Ä–∞—Ñ–∏–∫ engagement
4. –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –ø–µ—Ä–∏–æ–¥–æ–≤
```

**–§–∞–∑–∞ 4: –ò–Ω—Å–∞–π—Ç—ã (2 –¥–Ω—è)**
```bash
1. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π
2. –ê–Ω–∞–ª–∏–∑ —Ç—Ä–µ–Ω–¥–æ–≤
3. –õ—É—á—à–µ–µ –≤—Ä–µ–º—è –ø—É–±–ª–∏–∫–∞—Ü–∏–∏
4. –¢–æ–ø —Ç–µ–º—ã –∏ —Ç–µ–≥–∏
```

### ‚ö†Ô∏è –†–∏—Å–∫–∏
- **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**: –ê–≥—Ä–µ–≥–∞—Ü–∏—è –º–æ–∂–µ—Ç –±—ã—Ç—å –º–µ–¥–ª–µ–Ω–Ω–æ–π
  - *–†–µ—à–µ–Ω–∏–µ*: –ú–∞—Ç–µ—Ä–∏–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è, –ø—Ä–µ–¥—Ä–∞—Å—á–µ—Ç —á–µ—Ä–µ–∑ cron
- **–¢–æ—á–Ω–æ—Å—Ç—å –º–µ—Ç—Ä–∏–∫**: –ú–æ–≥—É—Ç –±—ã—Ç—å —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏—è
  - *–†–µ—à–µ–Ω–∏–µ*: –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö, –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–æ–∫
- **Privacy**: –°–ª–∏—à–∫–æ–º –¥–µ—Ç–∞–ª—å–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ –º–æ–∂–µ—Ç —Ä–∞—Å–∫—Ä—ã—Ç—å –ø—Ä–∏–≤–∞—Ç–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
  - *–†–µ—à–µ–Ω–∏–µ*: –ê–≥—Ä–µ–≥–∞—Ü–∏—è –ø–æ –¥–Ω—è–º, –±–µ–∑ –ª–∏—á–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –∑—Ä–∏—Ç–µ–ª–µ–π

### ‚úÖ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞
- üìä **–ú–æ—Ç–∏–≤–∞—Ü–∏—è**: –ê–≤—Ç–æ—Ä—ã –≤–∏–¥—è—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å–≤–æ–∏—Ö —É—Å–∏–ª–∏–π
- üéØ **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è**: –ü–æ–Ω–∏–º–∞—é—Ç —á—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç, —á—Ç–æ –Ω–µ—Ç
- üìà **–†–æ—Å—Ç**: –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ–º–æ–≥–∞—é—Ç —É–ª—É—á—à–∞—Ç—å –∫–æ–Ω—Ç–µ–Ω—Ç
- üí∞ **–ú–æ–Ω–µ—Ç–∏–∑–∞—Ü–∏—è**: –í –±—É–¥—É—â–µ–º –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å Premium analytics

### üìä –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: üü° –°–†–ï–î–ù–ò–ô
**ROI**: 7/10 | **–°–ª–æ–∂–Ω–æ—Å—Ç—å**: 6/10 | **–°—Ä–æ–∫**: 1-2 –Ω–µ–¥–µ–ª–∏

---

*(–ü—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ –≤ —Ñ–∞–π–ª–µ)*

---

# –ö—Ä–∞—Ç–∫–∞—è —Å–≤–æ–¥–∫–∞ –ø–æ –≤—Å–µ–º 10 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è–º

1. **–°–∏—Å—Ç–µ–º–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π** - üî¥ –í–´–°–û–ö–ò–ô (ROI: 9/10)
2. **–ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π –ø–æ–∏—Å–∫** - üî¥ –í–´–°–û–ö–ò–ô (ROI: 10/10)
3. **–ü—Ä–∏–≤–∞—Ç–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è** - üü° –°–†–ï–î–ù–ò–ô (ROI: 8/10)
4. **–ú–æ–¥–µ—Ä–∞—Ü–∏—è –∏ —Ä–µ–ø–æ—Ä—Ç—ã** - üî¥ –í–´–°–û–ö–ò–ô (ROI: 9/10)
5. **–ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –¥–ª—è –∞–≤—Ç–æ—Ä–æ–≤** - üü° –°–†–ï–î–ù–ò–ô (ROI: 7/10)
6. **–ü–æ–¥–ø–∏—Å–∫–∏ –Ω–∞ –∞–≤—Ç–æ—Ä–æ–≤** - üü° –°–†–ï–î–ù–ò–ô (ROI: 8/10)
7. **–†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π Markdown** - üü¢ –ù–ò–ó–ö–ò–ô (ROI: 6/10)
8. **SEO –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è** - üî¥ –í–´–°–û–ö–ò–ô (ROI: 9/10)
9. **–ì–µ–π–º–∏—Ñ–∏–∫–∞—Ü–∏—è** - üü¢ –ù–ò–ó–ö–ò–ô (ROI: 7/10)
10. **AI-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç** - üü¢ –ù–ò–ó–ö–ò–ô (ROI: 6/10)

## –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–∞—è –æ—á–µ—Ä–µ–¥–Ω–æ—Å—Ç—å:
1. SEO –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è (–±—ã—Å—Ç—Ä—ã–π wins)
2. –°–∏—Å—Ç–µ–º–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π (–∫—Ä–∏—Ç–∏—á–Ω–æ –¥–ª—è engagement)
3. –ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π –ø–æ–∏—Å–∫ (–∫—Ä–∏—Ç–∏—á–Ω–æ –¥–ª—è UX)
4. –ú–æ–¥–µ—Ä–∞—Ü–∏—è (–∫—Ä–∏—Ç–∏—á–Ω–æ –ø–µ—Ä–µ–¥ –ø—É–±–ª–∏—á–Ω—ã–º –∑–∞–ø—É—Å–∫–æ–º)
5. –û—Å—Ç–∞–ª—å–Ω–æ–µ –ø–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏
