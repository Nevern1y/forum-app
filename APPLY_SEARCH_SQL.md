# üîç –ü–†–ò–ú–ï–ù–ò–¢–¨ FULL-TEXT SEARCH –ú–ò–ì–†–ê–¶–ò–Æ

## ‚ö†Ô∏è –û—à–∏–±–∫–∞
```
[Search] Error searching posts: {}
```

**–ü—Ä–∏—á–∏–Ω–∞:** RPC —Ñ—É–Ω–∫—Ü–∏—è `search_posts` –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö.

**–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–∏–º–µ–Ω–∏—Ç—å SQL –º–∏–≥—Ä–∞—Ü–∏—é `033_add_full_text_search.sql`

---

## üìã –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è (5 –º–∏–Ω—É—Ç)

### 1. –û—Ç–∫—Ä–æ–π—Ç–µ Supabase Dashboard
```
https://supabase.com/dashboard/project/YOUR_PROJECT_ID
```

### 2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ SQL Editor
```
Left Sidebar ‚Üí SQL Editor
```

### 3. –û—Ç–∫—Ä–æ–π—Ç–µ —Ñ–∞–π–ª –º–∏–≥—Ä–∞—Ü–∏–∏
```
File: supabase/migrations/033_add_full_text_search.sql
```

### 4. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –í–ï–°–¨ SQL –∫–æ–¥
- –û—Ç–∫—Ä–æ–π—Ç–µ —Ñ–∞–π–ª –≤ —Ä–µ–¥–∞–∫—Ç–æ—Ä–µ
- Ctrl+A ‚Üí Ctrl+C
- **379 —Å—Ç—Ä–æ–∫** (–≤–µ—Å—å —Ñ–∞–π–ª —Ü–µ–ª–∏–∫–æ–º!)

### 5. –í—Å—Ç–∞–≤—å—Ç–µ –≤ SQL Editor
- –í Supabase Dashboard: New Query
- Ctrl+V
- –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –≤–µ—Å—å –∫–æ–¥ –≤—Å—Ç–∞–≤–ª–µ–Ω

### 6. –ó–∞–ø—É—Å—Ç–∏—Ç–µ (Run)
```
–ù–∞–∂–º–∏—Ç–µ "Run" –∏–ª–∏ Ctrl+Enter
```

### 7. –ñ–¥–∏—Ç–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è (~30-60 —Å–µ–∫—É–Ω–¥)
```
–ë—É–¥–µ—Ç —Å–æ–∑–¥–∞–Ω–æ:
‚úÖ 2 –∫–æ–ª–æ–Ω–∫–∏ (search_vector)
‚úÖ 4 –∏–Ω–¥–µ–∫—Å–∞ (GIN indexes)
‚úÖ 2 —Ñ—É–Ω–∫—Ü–∏–∏ (update triggers)
‚úÖ 2 —Ç—Ä–∏–≥–≥–µ—Ä–∞ (auto-update)
‚úÖ 3 RPC —Ñ—É–Ω–∫—Ü–∏–∏ (search_posts, search_users, get_search_suggestions)
‚úÖ –ó–∞–ø–æ–ª–Ω–µ–Ω—ã —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –¥–∞–Ω–Ω—ã–µ
```

### 8. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç
```
–î–æ–ª–∂–Ω–æ –±—ã—Ç—å: "Success. No rows returned"
```

---

## ‚úÖ –ü–æ—Å–ª–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è

### –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ —Å–æ–∑–¥–∞–Ω–æ:

1. **–ö–æ–ª–æ–Ω–∫–∏:**
```sql
SELECT column_name FROM information_schema.columns 
WHERE table_name = 'posts' AND column_name = 'search_vector';
-- –î–æ–ª–∂–Ω–∞ –≤–µ—Ä–Ω—É—Ç—å: search_vector
```

2. **RPC —Ñ—É–Ω–∫—Ü–∏–∏:**
```sql
SELECT routine_name FROM information_schema.routines 
WHERE routine_name LIKE 'search_%';
-- –î–æ–ª–∂–Ω—ã –±—ã—Ç—å:
-- search_posts
-- search_users
-- get_search_suggestions
```

3. **–ò–Ω–¥–µ–∫—Å—ã:**
```sql
SELECT indexname FROM pg_indexes 
WHERE tablename = 'posts' AND indexname LIKE '%search%';
-- –î–æ–ª–∂–µ–Ω –±—ã—Ç—å: idx_posts_search_vector
```

---

## üß™ –¢–µ—Å—Ç–∏—Ä—É–π—Ç–µ –ø–æ–∏—Å–∫

–ü–æ—Å–ª–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è SQL:

```bash
npm run dev
```

–û—Ç–∫—Ä–æ–π—Ç–µ: `http://localhost:3000/search`

**–î–æ–ª–∂–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å:**
- ‚úÖ –ü–æ–∏—Å–∫ –ø–æ –ø–æ—Å—Ç–∞–º
- ‚úÖ –ê–≤—Ç–æ–¥–æ–ø–æ–ª–Ω–µ–Ω–∏–µ
- ‚úÖ –ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è
- ‚úÖ –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ (relevance/recent/popular)
- ‚úÖ –ò—Å—Ç–æ—Ä–∏—è –ø–æ–∏—Å–∫–∞
- ‚úÖ Trending searches

---

## üî• –ß—Ç–æ –¥–∞—Å—Ç Full-Text Search?

### Performance:
```
LIKE '%query%': ~2000ms
Full-Text Search: ~50ms
```
**40x –±—ã—Å—Ç—Ä–µ–µ!** ‚ö°

### Features:
- –£–º–Ω–æ–µ —Ä–∞–Ω–∂–∏—Ä–æ–≤–∞–Ω–∏–µ (title –≤–∞–∂–Ω–µ–µ content)
- –ú–æ—Ä—Ñ–æ–ª–æ–≥–∏—è (–Ω–∞—Ö–æ–¥–∏—Ç "–Ω–∞–ø–∏—Å–∞–ª", "–ø–∏—à–µ—Ç", "–ø–∏—Å–∞—Ç—å")
- –°—Ç–æ–ø-—Å–ª–æ–≤–∞ (–∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç "–∏", "–≤", "–Ω–∞")
- GIN –∏–Ω–¥–µ–∫—Å—ã (–º–≥–Ω–æ–≤–µ–Ω–Ω—ã–π –ø–æ–∏—Å–∫)

---

## üÜò –ï—Å–ª–∏ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–∏

### –û—à–∏–±–∫–∞: "column already exists"
```sql
-- –ó–Ω–∞—á–∏—Ç —É–∂–µ –ø—Ä–∏–º–µ–Ω—è–ª–æ—Å—å, –º–æ–∂–Ω–æ –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å
-- –ò–ª–∏ —É–¥–∞–ª–∏—Ç–µ –∏ —Å–æ–∑–¥–∞–π—Ç–µ –∑–∞–Ω–æ–≤–æ:
DROP TRIGGER IF EXISTS trigger_update_posts_search_vector ON posts;
DROP FUNCTION IF EXISTS update_posts_search_vector();
ALTER TABLE posts DROP COLUMN IF EXISTS search_vector;
-- –ó–∞—Ç–µ–º –ø—Ä–∏–º–µ–Ω–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏—é —Å–Ω–æ–≤–∞
```

### –û—à–∏–±–∫–∞: "function already exists"
```sql
-- –ó–∞–º–µ–Ω–∏—Ç–µ CREATE –Ω–∞ CREATE OR REPLACE
-- –ò–ª–∏ —É–¥–∞–ª–∏—Ç–µ —Ñ—É–Ω–∫—Ü–∏–∏:
DROP FUNCTION IF EXISTS search_posts(text, text, uuid, timestamp, timestamp, text, int, int);
DROP FUNCTION IF EXISTS search_users(text, int);
DROP FUNCTION IF EXISTS get_search_suggestions(text, int);
-- –ó–∞—Ç–µ–º –ø—Ä–∏–º–µ–Ω–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏—é —Å–Ω–æ–≤–∞
```

---

## üìù –ü—Ä–∏–º–µ—á–∞–Ω–∏—è

1. **–ë—ç–∫–∞–ø –Ω–µ –Ω—É–∂–µ–Ω** - –º–∏–≥—Ä–∞—Ü–∏—è —Ç–æ–ª—å–∫–æ –¥–æ–±–∞–≤–ª—è–µ—Ç, –Ω–∏—á–µ–≥–æ –Ω–µ —É–¥–∞–ª—è–µ—Ç
2. **Downtime –Ω–µ—Ç** - –≤—Å–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤–æ –≤—Ä–µ–º—è –º–∏–≥—Ä–∞—Ü–∏–∏
3. **–î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è** - —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ø–æ—Å—Ç—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏–Ω–¥–µ–∫—Å–∏—Ä—É—é—Ç—Å—è
4. **–†—É—Å—Å–∫–∏–π —è–∑—ã–∫** - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `'russian'` –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –¥–ª—è –º–æ—Ä—Ñ–æ–ª–æ–≥–∏–∏

---

## üéâ –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è

–°—Ç—Ä–∞–Ω–∏—Ü–∞ –ø–æ–∏—Å–∫–∞ –∑–∞—Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é:
- Premium UI ‚ú®
- –ë—ã—Å—Ç—Ä—ã–π –ø–æ–∏—Å–∫ ‚ö°
- –£–º–Ω—ã–µ –ø–æ–¥—Å–∫–∞–∑–∫–∏ üß†
- –ö—Ä–∞—Å–∏–≤—ã–µ –∞–Ω–∏–º–∞—Ü–∏–∏ üé®

**–ì–æ—Ç–æ–≤–æ –∫ production!** üöÄ
