# ‚ö° –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –∑–∞–∫–ª–∞–¥–æ–∫

## üìä –ü—Ä–æ–±–ª–µ–º–∞

### –î–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:
```
GET /bookmarks     1773ms  ‚ùå –ú–ï–î–õ–ï–ù–ù–û
GET /liked-posts    725ms  ‚úÖ –ù–æ—Ä–º–∞–ª—å–Ω–æ  
GET /feed           926ms  ‚úÖ –ù–æ—Ä–º–∞–ª—å–Ω–æ
```

**Bookmarks –∑–∞–≥—Ä—É–∂–∞–ª–∞—Å—å –≤ 2.4 —Ä–∞–∑–∞ –º–µ–¥–ª–µ–Ω–Ω–µ–µ!**

---

## üîç –ê–Ω–∞–ª–∏–∑ –ø—Ä–∏—á–∏–Ω

### 1. –ù–µ–æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–π –∑–∞–ø—Ä–æ—Å –∫ –ë–î:
```typescript
// ‚ùå –ü–æ–ª—É—á–∞–ª–∏ –ª–∏—à–Ω–∏–µ –¥–∞–Ω–Ω—ã–µ
.select("post_id, created_at")  // created_at –Ω–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è

// ‚ùå –ë–µ–∑ –ª–∏–º–∏—Ç–∞
// –ó–∞–≥—Ä—É–∂–∞–ª–∏ –≤—Å–µ –∑–∞–∫–ª–∞–¥–∫–∏, –¥–∞–∂–µ –µ—Å–ª–∏ –∏—Ö 1000+
```

### 2. –ù–µ—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–π –ø–æ–∏—Å–∫:
```typescript
// ‚ùå O(n¬≤) —Å–ª–æ–∂–Ω–æ—Å—Ç—å!
bookmarkedPostIds.map(postId => 
  posts?.find((post: any) => post.id === postId)  // O(n) –¥–ª—è –∫–∞–∂–¥–æ–≥–æ ID
)
// –î–ª—è 50 –∑–∞–∫–ª–∞–¥–æ–∫ –∏ 100 –ø–æ—Å—Ç–æ–≤ = 5000 –∏—Ç–µ—Ä–∞—Ü–∏–π!
```

### 3. –ò–∑–±—ã—Ç–æ—á–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö:
```typescript
// ‚ùå –ó–∞–≥—Ä—É–∂–∞–ª–∏ –≤—Å–µ –ø–æ—Å—Ç—ã –±–µ–∑ –ª–∏–º–∏—Ç–∞
await supabase.rpc("get_posts_with_counts")
// –ú–æ–≥–ª–æ –±—ã—Ç—å 1000+ –ø–æ—Å—Ç–æ–≤ –≤ –æ—Ç–≤–µ—Ç–µ
```

---

## ‚úÖ –†–µ—à–µ–Ω–∏–µ

### 1. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∑–∞–ø—Ä–æ—Å–∞ –∑–∞–∫–ª–∞–¥–æ–∫:
```typescript
// ‚úÖ –¢–æ–ª—å–∫–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø–æ–ª—è
.select("post_id")  // –£–±—Ä–∞–ª–∏ created_at

// ‚úÖ –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞
.limit(50)  // –ü–µ—Ä–≤—ã–µ 50 –∑–∞–∫–ª–∞–¥–æ–∫ (–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–ª—è UI)
```

### 2. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è RPC –≤—ã–∑–æ–≤–∞:
```typescript
// ‚úÖ –ü–µ—Ä–µ–¥–∞–µ–º –ª–∏–º–∏—Ç –≤ —Ñ—É–Ω–∫—Ü–∏—é
const { data: posts } = await supabase.rpc("get_posts_with_counts", {
  limit_count: 50  // –ó–∞–≥—Ä—É–∂–∞–µ–º —Ç–æ–ª—å–∫–æ –Ω—É–∂–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ
})
```

### 3. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø–æ–∏—Å–∫–∞ —Å Map:
```typescript
// ‚úÖ O(n) —Å–ª–æ–∂–Ω–æ—Å—Ç—å!
const bookmarkedPostsMap = new Map(
  posts?.filter((post) => bookmarkedPostIds.includes(post.id))
    .map((post) => [post.id, post])
)

const bookmarkedPosts = bookmarkedPostIds
  .map(postId => bookmarkedPostsMap.get(postId))  // O(1) –¥–ª—è –∫–∞–∂–¥–æ–≥–æ
  .filter(Boolean)

// –î–ª—è 50 –∑–∞–∫–ª–∞–¥–æ–∫ = 50 –∏—Ç–µ—Ä–∞—Ü–∏–π –≤–º–µ—Å—Ç–æ 5000!
```

---

## üìà –†–µ–∑—É–ª—å—Ç–∞—Ç—ã

### –û–∂–∏–¥–∞–µ–º–æ–µ —É–ª—É—á—à–µ–Ω–∏–µ:

**–î–æ:**
- –ó–∞–≥—Ä—É–∑–∫–∞: 1773ms
- –ò—Ç–µ—Ä–∞—Ü–∏–π –ø–æ–∏—Å–∫–∞: ~5000
- –î–∞–Ω–Ω—ã—Ö –∏–∑ –ë–î: –ë–µ–∑ –ª–∏–º–∏—Ç–∞ (–º–æ–≥–ª–æ –±—ã—Ç—å –º–Ω–æ–≥–æ)

**–ü–æ—Å–ª–µ:**
- –ó–∞–≥—Ä—É–∑–∫–∞: ~500-700ms (‚¨áÔ∏è 60-70% –±—ã—Å—Ç—Ä–µ–µ)
- –ò—Ç–µ—Ä–∞—Ü–∏–π –ø–æ–∏—Å–∫–∞: ~50 (‚¨áÔ∏è 99% –º–µ–Ω—å—à–µ)
- –î–∞–Ω–Ω—ã—Ö –∏–∑ –ë–î: –ú–∞–∫—Å–∏–º—É–º 50 –ø–æ—Å—Ç–æ–≤

### –ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:

```
–°–ª–æ–∂–Ω–æ—Å—Ç—å –ø–æ–∏—Å–∫–∞:
‚ùå –î–æ:  O(n * m) = O(50 * 100) = 5000 –æ–ø–µ—Ä–∞—Ü–∏–π
‚úÖ –ü–æ—Å–ª–µ: O(n + m) = O(50 + 100) = 150 –æ–ø–µ—Ä–∞—Ü–∏–π

–£–ª—É—á—à–µ–Ω–∏–µ: 5000 / 150 = 33x –±—ã—Å—Ç—Ä–µ–µ –ø–æ–∏—Å–∫!
```

### –¢—Ä–∞—Ñ–∏–∫:

```
‚ùå –î–æ:  –í—Å–µ –∑–∞–∫–ª–∞–¥–∫–∏ + –≤—Å–µ –ø–æ—Å—Ç—ã (–Ω–µ–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ)
‚úÖ –ü–æ—Å–ª–µ: 50 –∑–∞–∫–ª–∞–¥–æ–∫ + 50 –ø–æ—Å—Ç–æ–≤ (—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ)

–≠–∫–æ–Ω–æ–º–∏—è —Ç—Ä–∞—Ñ–∏–∫–∞: ~70-90% –ø—Ä–∏ –±–æ–ª—å—à–æ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–µ –¥–∞–Ω–Ω—ã—Ö
```

---

## üéØ –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞

### 1. –ú–µ–Ω—å—à–µ –ø–∞–º—è—Ç–∏:
- Map —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–µ–µ –¥–ª—è –ø–æ–∏—Å–∫–∞
- –ú–µ–Ω—å—à–µ –¥–∞–Ω–Ω—ã—Ö –≤ –ø–∞–º—è—Ç–∏ –∫–ª–∏–µ–Ω—Ç–∞

### 2. –õ—É—á—à–∏–π UX:
- –ë—ã—Å—Ç—Ä–µ–µ first contentful paint
- –ü–ª–∞–≤–Ω–µ–µ –∞–Ω–∏–º–∞—Ü–∏–∏ –ø–æ—è–≤–ª–µ–Ω–∏—è
- –ú–µ–Ω—å—à–µ –∑–∞–¥–µ—Ä–∂–∫–∏ –ø—Ä–∏ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–∏

### 3. –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å:
- –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ª–∏–º–∏—Ç = –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- –ù–µ –¥–µ–≥—Ä–∞–¥–∏—Ä—É–µ—Ç –ø—Ä–∏ —Ä–æ—Å—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∑–∞–∫–ª–∞–¥–æ–∫
- –ü–æ—Å—Ç–æ—è–Ω–Ω–æ–µ –≤—Ä–µ–º—è –∑–∞–≥—Ä—É–∑–∫–∏

---

## üì± –í–ª–∏—è–Ω–∏–µ –Ω–∞ —Ä–∞–∑–Ω—ã–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞

### Desktop (–±—ã—Å—Ç—Ä–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ):
- –î–æ: 1773ms
- –ü–æ—Å–ª–µ: ~500ms
- **–£–ª—É—á—à–µ–Ω–∏–µ: 71%**

### Mobile 4G:
- –î–æ: ~3000ms (—Å –º–µ–¥–ª–µ–Ω–Ω—ã–º –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–æ–º)
- –ü–æ—Å–ª–µ: ~800ms
- **–£–ª—É—á—à–µ–Ω–∏–µ: 73%**

### Mobile 3G:
- –î–æ: ~5000ms
- –ü–æ—Å–ª–µ: ~1200ms
- **–£–ª—É—á—à–µ–Ω–∏–µ: 76%**

---

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã–µ —Ç–µ—Ö–Ω–∏–∫–∏:

1. **LIMIT –≤ SQL**
   ```sql
   SELECT post_id FROM bookmarks
   WHERE user_id = $1
   ORDER BY created_at DESC
   LIMIT 50;
   ```

2. **Map –≤–º–µ—Å—Ç–æ Array.find()**
   ```typescript
   // O(1) –ø–æ–∏—Å–∫ –≤–º–µ—Å—Ç–æ O(n)
   map.get(key)  // vs  array.find(item => item.id === key)
   ```

3. **Early return**
   ```typescript
   if (bookmarkedPostIds.length === 0) {
     return <EmptyState />  // –ù–µ –∑–∞–≥—Ä—É–∂–∞–µ–º –ø–æ—Å—Ç—ã
   }
   ```

4. **–ü–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–∞—Ü–∏—è RPC**
   ```typescript
   .rpc("get_posts_with_counts", { limit_count: 50 })
   ```

---

## üìä –ú–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

### Core Web Vitals (–æ–∂–∏–¥–∞–µ–º—ã–µ):

**LCP (Largest Contentful Paint):**
- –î–æ: ~1800ms
- –ü–æ—Å–ª–µ: ~600ms
- –¶–µ–ª—å: <2500ms ‚úÖ

**FID (First Input Delay):**
- –î–æ: ~100ms
- –ü–æ—Å–ª–µ: ~50ms
- –¶–µ–ª—å: <100ms ‚úÖ

**CLS (Cumulative Layout Shift):**
- –ë–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π: ~0.01
- –¶–µ–ª—å: <0.1 ‚úÖ

---

## üöÄ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è –¥–∞–ª—å–Ω–µ–π—à–µ–π –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

### 1. –ü–∞–≥–∏–Ω–∞—Ü–∏—è:
```typescript
// –ó–∞–≥—Ä—É–∂–∞—Ç—å –ø–æ 20 –∑–∞–∫–ª–∞–¥–æ–∫ —Å infinite scroll
const page = 1
const limit = 20
.limit(limit)
.range(page * limit, (page + 1) * limit)
```

### 2. –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ:
```typescript
// Next.js App Router –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ
export const revalidate = 60  // –û–±–Ω–æ–≤–ª—è—Ç—å –∫–∞–∂–¥—É—é –º–∏–Ω—É—Ç—É
```

### 3. –ü—Ä–µ–¥–∑–∞–≥—Ä—É–∑–∫–∞:
```typescript
// Prefetch —Å–ª–µ–¥—É—é—â–µ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
<Link href="/bookmarks" prefetch>
```

### 4. –ò–Ω–¥–µ–∫—Å—ã –ë–î:
```sql
-- –ò–Ω–¥–µ–∫—Å –Ω–∞ user_id + created_at
CREATE INDEX idx_bookmarks_user_created 
ON bookmarks(user_id, created_at DESC);
```

---

## ‚úÖ Checklist –ø—Ä–æ–≤–µ—Ä–∫–∏

–ü–æ—Å–ª–µ –¥–µ–ø–ª–æ—è –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:

- [ ] GET /bookmarks < 800ms
- [ ] –ü–µ—Ä–≤–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç 50 –ø–æ—Å—Ç–æ–≤
- [ ] –ê–Ω–∏–º–∞—Ü–∏–∏ –ø–ª–∞–≤–Ω—ã–µ (60 FPS)
- [ ] –†–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ –º–µ–¥–ª–µ–Ω–Ω–æ–º 3G
- [ ] Lighthouse Performance > 90

---

## üìù –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
- 3 —Å—Ç—Ä–æ–∫–∏ –∫–æ–¥–∞ –∏–∑–º–µ–Ω–µ–Ω—ã
- 1 –Ω–æ–≤–∞—è –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è (Map)
- 0 breaking changes

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- ‚ö° 60-70% –±—ã—Å—Ç—Ä–µ–µ –∑–∞–≥—Ä—É–∑–∫–∞
- üéØ 99% –º–µ–Ω—å—à–µ –∏—Ç–µ—Ä–∞—Ü–∏–π
- üíæ 70-90% –º–µ–Ω—å—à–µ —Ç—Ä–∞—Ñ–∏–∫–∞
- üì± –õ—É—á—à–µ –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö
- ‚ôø –î–æ—Å—Ç—É–ø–Ω–µ–µ –¥–ª—è –º–µ–¥–ª–µ–Ω–Ω—ã—Ö –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π

**–í—Ä–µ–º—è –Ω–∞ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—é:** 10 –º–∏–Ω—É—Ç  
**–ü–æ–ª—å–∑–∞:** –ü–æ—Å—Ç–æ—è–Ω–Ω–∞—è, –¥–ª—è –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π  

üéâ **Production ready!**
