# üöÄ Migration Guide - –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π

## ‚ö†Ô∏è –í–ê–ñ–ù–û! –í—ã–ø–æ–ª–Ω–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏—é –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

### –®–∞–≥ 1: –û—Ç–∫—Ä–æ–π—Ç–µ Supabase Dashboard

1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ https://supabase.com/dashboard
2. –í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—à –ø—Ä–æ–µ–∫—Ç
3. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **SQL Editor** (–ª–µ–≤–æ–µ –º–µ–Ω—é)

### –®–∞–≥ 2: –í—ã–ø–æ–ª–Ω–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏—é

–°–∫–æ–ø–∏—Ä—É–π—Ç–µ –∏ –≤—Å—Ç–∞–≤—å—Ç–µ **–ø–æ–ª–Ω–æ—Å—Ç—å—é** —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞:
```
supabase/migrations/run_all_migrations.sql
```

–ò–ª–∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ —Ç–æ–ª—å–∫–æ Migration 008 (–µ—Å–ª–∏ –æ—Å—Ç–∞–ª—å–Ω—ã–µ —É–∂–µ –ø—Ä–∏–º–µ–Ω–µ–Ω—ã):

```sql
-- Add media columns to posts
ALTER TABLE posts 
ADD COLUMN IF NOT EXISTS media_urls TEXT[] DEFAULT '{}',
ADD COLUMN IF NOT EXISTS audio_url TEXT;

-- Create indexes
CREATE INDEX IF NOT EXISTS idx_posts_media_urls 
  ON posts USING GIN (media_urls);

CREATE INDEX IF NOT EXISTS idx_posts_audio_url 
  ON posts (audio_url) WHERE audio_url IS NOT NULL;

-- Add comments
COMMENT ON COLUMN posts.media_urls 
  IS 'Array of URLs for images/videos attached to the post';

COMMENT ON COLUMN posts.audio_url 
  IS 'URL for voice message attached to the post';
```

### –®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ

–î–æ–ª–∂–Ω—ã –ø–æ—è–≤–∏—Ç—å—Å—è —Å–æ–æ–±—â–µ–Ω–∏—è:
```
‚úì Success. No rows returned
```

–ï—Å–ª–∏ –ø–æ—è–≤–ª—è—é—Ç—Å—è –æ—à–∏–±–∫–∏ —Ç–∏–ø–∞ "column already exists" - —ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ, –∑–Ω–∞—á–∏—Ç –∫–æ–ª–æ–Ω–∫–∞ —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç.

### –®–∞–≥ 4: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ Storage Bucket

–í Supabase Dashboard ‚Üí **Storage** –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞–ª–∏—á–∏–µ bucket:
- `post-images` (–¥–æ–ª–∂–µ–Ω –±—ã—Ç—å public)

–ï—Å–ª–∏ –Ω–µ—Ç - —Å–æ–∑–¥–∞–π—Ç–µ –≤—Ä—É—á–Ω—É—é:
1. Storage ‚Üí New Bucket
2. Name: `post-images`
3. Public: ‚úÖ (–≤–∫–ª—é—á–µ–Ω–æ)
4. File size limit: 5MB

## ‚úÖ –ß—Ç–æ –±—ã–ª–æ –¥–æ–±–∞–≤–ª–µ–Ω–æ

### üé® –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

```
components/media/
‚îú‚îÄ‚îÄ image-uploader.tsx           ‚ú® NEW
‚îú‚îÄ‚îÄ voice-recorder.tsx           ‚ú® NEW
‚îú‚îÄ‚îÄ media-gallery.tsx            ‚ú® NEW
‚îú‚îÄ‚îÄ audio-player.tsx             ‚ú® NEW
‚îî‚îÄ‚îÄ audio-player-compact.tsx     ‚ú® NEW
```

### üóÑÔ∏è –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

```sql
posts table:
‚îú‚îÄ‚îÄ media_urls (TEXT[])          ‚ú® NEW
‚îî‚îÄ‚îÄ audio_url (TEXT)             ‚ú® NEW
```

### üìù –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

```
components/post/create-post-form.tsx    (–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏)
components/feed/post-card.tsx           (–∫–æ–º–ø–∞–∫—Ç–Ω—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä)
app/post/[id]/page.tsx                  (–ø–æ–ª–Ω—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä)
```

## üéØ –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

### –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ—Å—Ç–∞ —Å –º–µ–¥–∏–∞

1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ `/post/create`
2. –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –∑–∞–≥–æ–ª–æ–≤–æ–∫ –∏ –∫–æ–Ω—Ç–µ–Ω—Ç
3. **–î–æ–±–∞–≤—å—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è:**
   - –ö–Ω–æ–ø–∫–∞ "–î–æ–±–∞–≤–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è"
   - –ú–∞–∫—Å. 5 –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
   - –ú–∞–∫—Å. 5MB –∫–∞–∂–¥–æ–µ
   - –ü—Ä–µ–≤—å—é —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é —É–¥–∞–ª–µ–Ω–∏—è
4. **–ó–∞–ø–∏—à–∏—Ç–µ –≥–æ–ª–æ—Å–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ:**
   - –ö–Ω–æ–ø–∫–∞ "–ù–∞—á–∞—Ç—å –∑–∞–ø–∏—Å—å"
   - –ó–∞–ø—Ä–æ—Å –¥–æ—Å—Ç—É–ø–∞ –∫ –º–∏–∫—Ä–æ—Ñ–æ–Ω—É
   - –¢–∞–π–º–µ—Ä –∑–∞–ø–∏—Å–∏
   - –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä —Å Play/Pause
5. –û–ø—É–±–ª–∏–∫—É–π—Ç–µ –ø–æ—Å—Ç

### –ü—Ä–æ—Å–º–æ—Ç—Ä –º–µ–¥–∏–∞

**–í –ª–µ–Ω—Ç–µ –ø–æ—Å—Ç–æ–≤:**
- ‚úÖ –ö–æ–º–ø–∞–∫—Ç–Ω—ã–µ –ø—Ä–µ–≤—å—é (128-160px)
- ‚úÖ –ú–∞–∫—Å. 3 –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è + "+N"
- ‚úÖ –ö–æ–º–ø–∞–∫—Ç–Ω—ã–π –∞—É–¥–∏–æ –ø–ª–µ–µ—Ä
- ‚úÖ –ö–ª–∏–∫ ‚Üí Lightbox —Å–æ –≤—Å–µ–º–∏ —Ñ–æ—Ç–æ

**–í –¥–µ—Ç–∞–ª—å–Ω–æ–º –ø—Ä–æ—Å–º–æ—Ç—Ä–µ:**
- ‚úÖ –í—Å–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –ø–æ–ª–Ω–æ—Å—Ç—å—é
- ‚úÖ –ê–¥–∞–ø—Ç–∏–≤–Ω–∞—è —Å–µ—Ç–∫–∞
- ‚úÖ –ü–æ–ª–Ω—ã–π –∞—É–¥–∏–æ –ø–ª–µ–µ—Ä —Å –∫–æ–Ω—Ç—Ä–æ–ª–∞–º–∏
- ‚úÖ –ö–ª–∏–∫ ‚Üí Lightbox —Å –Ω–∞–≤–∏–≥–∞—Ü–∏–µ–π

## üé® –†–∞–∑–º–µ—Ä—ã –∏ —Å—Ç–∏–ª–∏

### –ö–æ–º–ø–∞–∫—Ç–Ω—ã–π —Ä–µ–∂–∏–º (–ª–µ–Ω—Ç–∞):
```
–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è:
‚îú‚îÄ‚îÄ 1 —Ñ–æ—Ç–æ: 160px –≤—ã—Å–æ—Ç–∞
‚îú‚îÄ‚îÄ 2-3 —Ñ–æ—Ç–æ: 128px –≤—ã—Å–æ—Ç–∞
‚îî‚îÄ‚îÄ –®–∏—Ä–∏–Ω–∞: 100%

–ê—É–¥–∏–æ –ø–ª–µ–µ—Ä:
‚îú‚îÄ‚îÄ –í—ã—Å–æ—Ç–∞: 52px
‚îú‚îÄ‚îÄ –ö–Ω–æ–ø–∫–∏: 32px
‚îî‚îÄ‚îÄ Progress bar: 6px
```

### –ü–æ–ª–Ω—ã–π —Ä–µ–∂–∏–º (–ø–æ—Å—Ç):
```
–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è:
‚îú‚îÄ‚îÄ Adaptive height
‚îú‚îÄ‚îÄ aspect-video (1 —Ñ–æ—Ç–æ)
‚îî‚îÄ‚îÄ aspect-square (2+ —Ñ–æ—Ç–æ)

–ê—É–¥–∏–æ –ø–ª–µ–µ—Ä:
‚îú‚îÄ‚îÄ –í—ã—Å–æ—Ç–∞: 68px
‚îú‚îÄ‚îÄ Seek controls: ‚úÖ
‚îî‚îÄ‚îÄ Mute/Unmute: ‚úÖ
```

## üîß –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –æ—à–∏–±–æ–∫

### –û—à–∏–±–∫–∞: "ENOENT: no such file or directory"

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –û—á–∏—Å—Ç–∏—Ç–µ –∫–µ—à Next.js
rm -rf .next

# –ò–ª–∏ –≤ PowerShell:
Remove-Item -Recurse -Force .next

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ dev server
npm run dev
```

### –û—à–∏–±–∫–∞: "Failed to upload image"

**–ü—Ä–æ–≤–µ—Ä—å—Ç–µ:**
1. Storage bucket `post-images` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
2. Bucket is public (‚úÖ)
3. RLS policies –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã (–∏–∑ –º–∏–≥—Ä–∞—Ü–∏–∏)

### –û—à–∏–±–∫–∞: "column does not exist: media_urls"

**–†–µ—à–µ–Ω–∏–µ:**
1. –í—ã–ø–æ–ª–Ω–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏—é 008 (—Å–º. –≤—ã—à–µ)
2. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ dev server

## üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

–ü–æ–¥—Ä–æ–±–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –¥–æ—Å—Ç—É–ø–Ω–∞ –≤ —Ñ–∞–π–ª–∞—Ö:
- `MEDIA_FEATURES.md` - –ü–æ–ª–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–π
- `COMPACT_MEDIA_MODE.md` - –ö–æ–º–ø–∞–∫—Ç–Ω—ã–π —Ä–µ–∂–∏–º
- `MEDIA_IMPROVEMENTS.md` - –£–ª—É—á—à–µ–Ω–∏—è –≤–∏–¥–∏–º–æ—Å—Ç–∏
- `BUTTON_ANIMATIONS.md` - Ripple —ç—Ñ—Ñ–µ–∫—Ç—ã

## üöÄ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ß–µ–∫–ª–∏—Å—Ç:

1. **–ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π:**
   - [ ] –ó–∞–≥—Ä—É–∑–∏—Ç—å 1 –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
   - [ ] –ó–∞–≥—Ä—É–∑–∏—Ç—å 5 –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
   - [ ] –ü–æ–ø—ã—Ç–∞—Ç—å—Å—è –∑–∞–≥—Ä—É–∑–∏—Ç—å 6 (–¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –æ—à–∏–±–∫–∞)
   - [ ] –ü–æ–ø—ã—Ç–∞—Ç—å—Å—è –∑–∞–≥—Ä—É–∑–∏—Ç—å >5MB —Ñ–∞–π–ª (–¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –æ—à–∏–±–∫–∞)
   - [ ] –£–¥–∞–ª–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏–∑ –ø—Ä–µ–≤—å—é

2. **–ó–∞–ø–∏—Å—å –∞—É–¥–∏–æ:**
   - [ ] –ù–∞—á–∞—Ç—å –∑–∞–ø–∏—Å—å (—Ä–∞–∑—Ä–µ—à–∏—Ç—å –º–∏–∫—Ä–æ—Ñ–æ–Ω)
   - [ ] –í–∏–¥–µ—Ç—å —Ç–∞–π–º–µ—Ä –∑–∞–ø–∏—Å–∏
   - [ ] –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–ø–∏—Å—å
   - [ ] –ü—Ä–æ—Å–ª—É—à–∞—Ç—å –∑–∞–ø–∏—Å—å (Play/Pause)
   - [ ] –£–¥–∞–ª–∏—Ç—å –∑–∞–ø–∏—Å—å

3. **–ü—Ä–æ—Å–º–æ—Ç—Ä –≤ –ª–µ–Ω—Ç–µ:**
   - [ ] –í–∏–¥–µ—Ç—å –∫–æ–º–ø–∞–∫—Ç–Ω—ã–µ –ø—Ä–µ–≤—å—é
   - [ ] –ö–ª–∏–∫–Ω—É—Ç—å –Ω–∞ –ø—Ä–µ–≤—å—é ‚Üí lightbox
   - [ ] –ù–∞–≤–∏–≥–∞—Ü–∏—è —Å—Ç—Ä–µ–ª–∫–∞–º–∏ –≤ lightbox
   - [ ] –ü—Ä–æ–∏–≥—Ä–∞—Ç—å –∞—É–¥–∏–æ –≤ –ª–µ–Ω—Ç–µ

4. **–ü—Ä–æ—Å–º–æ—Ç—Ä –≤ –ø–æ—Å—Ç–µ:**
   - [ ] –í–∏–¥–µ—Ç—å –≤—Å–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
   - [ ] –ö–ª–∏–∫–Ω—É—Ç—å –Ω–∞ —Ñ–æ—Ç–æ ‚Üí lightbox
   - [ ] –ü–æ–ª–Ω—ã–π –∞—É–¥–∏–æ –ø–ª–µ–µ—Ä —Å seek
   - [ ] Mute/Unmute —Ä–∞–±–æ—Ç–∞–µ—Ç

5. **–ö–Ω–æ–ø–∫–∏:**
   - [ ] Ripple —ç—Ñ—Ñ–µ–∫—Ç –ø—Ä–∏ –∫–ª–∏–∫–µ
   - [ ] –ü–ª–∞–≤–Ω—ã–µ –∞–Ω–∏–º–∞—Ü–∏–∏ (0.5s)
   - [ ] –ö–Ω–æ–ø–∫–∏ –Ω–µ –¥–≤–∏–≥–∞—é—Ç—Å—è (—Ç–æ–ª—å–∫–æ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π —ç—Ñ—Ñ–µ–∫—Ç)

## ‚ú® –†–µ–∑—É–ª—å—Ç–∞—Ç

**–ì–æ—Ç–æ–≤–æ!** –¢–µ–ø–µ—Ä—å –≤–∞—à —Ñ–æ—Ä—É–º –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç:

‚úÖ –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è (–¥–æ 5)  
‚úÖ –ì–æ–ª–æ—Å–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è  
‚úÖ –ö–æ–º–ø–∞–∫—Ç–Ω—ã–µ –ø—Ä–µ–≤—å—é –≤ –ª–µ–Ω—Ç–µ  
‚úÖ –ü–æ–ª–Ω–æ—Ä–∞–∑–º–µ—Ä–Ω—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä –≤ –ø–æ—Å—Ç–µ  
‚úÖ Lightbox –≥–∞–ª–µ—Ä–µ—è —Å –Ω–∞–≤–∏–≥–∞—Ü–∏–µ–π  
‚úÖ –ü–ª–∞–≤–Ω—ã–µ ripple –∞–Ω–∏–º–∞—Ü–∏–∏  
‚úÖ –ú–∏–Ω–∏–º–∞–ª–∏—Å—Ç–∏—á–Ω—ã–π Threads-style –¥–∏–∑–∞–π–Ω  

## üÜò –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ï—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –º–∏–≥—Ä–∞—Ü–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∞
2. –û—á–∏—Å—Ç–∏—Ç–µ –∫–µ—à `.next`
3. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ dev server
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ Supabase Storage bucket
5. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ –Ω–∞ –æ—à–∏–±–∫–∏

---

**–ü—Ä–∏—è—Ç–Ω–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è!** üéâ
