# –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –≤—Å–µ –∫–ª—é—á–µ–≤—ã–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –±–æ–ª—å—à–∏–º–∏ –æ–±—ä—ë–º–∞–º–∏ –¥–∞–Ω–Ω—ã—Ö (1000+ –ø–æ—Å—Ç–æ–≤).

## üöÄ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

### 1. –í–∏—Ä—Ç—É–∞–ª–∏–∑–∞—Ü–∏—è –ª–µ–Ω—Ç—ã –ø–æ—Å—Ç–æ–≤
**–ë–∏–±–ª–∏–æ—Ç–µ–∫–∞:** `@tanstack/react-virtual`

**–ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ:**
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –≤–∏—Ä—Ç—É–∞–ª–∏–∑–∞—Ü–∏—è –≤ `InfinitePostList`
- –¢–æ–ª—å–∫–æ –≤–∏–¥–∏–º—ã–µ –ø–æ—Å—Ç—ã —Ä–µ–Ω–¥–µ—Ä—è—Ç—Å—è –≤ DOM (–æ—Å—Ç–∞–ª—å–Ω—ã–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–µ)
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–π –≤—ã—Å–æ—Ç—ã –ø–æ—Å—Ç–æ–≤
- Overscan: 5 —ç–ª–µ–º–µ–Ω—Ç–æ–≤ (—Ä–µ–Ω–¥–µ—Ä—è—Ç—Å—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ –∑–∞ –ø—Ä–µ–¥–µ–ª–∞–º–∏ –≤–∏–¥–∏–º–æ—Å—Ç–∏)

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- ‚ö° –ú–≥–Ω–æ–≤–µ–Ω–Ω–∞—è –ø—Ä–æ–∫—Ä—É—Ç–∫–∞ 1000+ –ø–æ—Å—Ç–æ–≤
- üìâ –°–Ω–∏–∂–µ–Ω–∏–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ø–∞–º—è—Ç–∏ –Ω–∞ 80-90%
- üéØ –¢–æ–ª—å–∫–æ ~15-20 –ø–æ—Å—Ç–æ–≤ –≤ DOM –≤–º–µ—Å—Ç–æ –≤—Å–µ—Ö

**–§–∞–π–ª—ã:**
- `components/feed/infinite-post-list.tsx`

### 2. –ú–µ–º–æ–∏–∑–∞—Ü–∏—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
**–¢–µ—Ö–Ω–æ–ª–æ–≥–∏—è:** React.memo + custom comparison

**–ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ:**
- `PostCard` –º–µ–º–æ–∏–∑–∏—Ä–æ–≤–∞–Ω —Å custom —Ñ—É–Ω–∫—Ü–∏–µ–π —Å—Ä–∞–≤–Ω–µ–Ω–∏—è
- `MediaGallery` –º–µ–º–æ–∏–∑–∏—Ä–æ–≤–∞–Ω
- –ü–µ—Ä–µ—Ä–µ–Ω–¥–µ—Ä —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –∫–ª—é—á–µ–≤—ã—Ö –ø–æ–ª–µ–π (likes, comments, user_has_liked)

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- üîÑ –ù–∞ 60-70% –º–µ–Ω—å—à–µ —Ä–µ-—Ä–µ–Ω–¥–µ—Ä–æ–≤
- ‚ö° –ü–ª–∞–≤–Ω–∞—è –ø—Ä–æ–∫—Ä—É—Ç–∫–∞ –±–µ–∑ –ª–∞–≥–æ–≤
- üé® –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –ª–∞–π–∫–æ–≤/–∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤

**–§–∞–π–ª—ã:**
- `components/feed/post-card.tsx`
- `components/media/media-gallery.tsx`

### 3. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
**–¢–µ—Ö–Ω–æ–ª–æ–≥–∏—è:** Next.js Image + lazy loading + blur placeholder

**–ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ:**
- –î–æ–±–∞–≤–ª–µ–Ω `loading="lazy"` –¥–ª—è –≤—Å–µ—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
- Blur placeholder –Ω–∞ –≤—Ä–µ–º—è –∑–∞–≥—Ä—É–∑–∫–∏
- –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ä–∞–∑–º–µ—Ä—ã: 200px (compact), 400px, 800px
- AVIF + WebP —Ñ–æ—Ä–º–∞—Ç—ã (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- üì∏ –ë—ã—Å—Ç—Ä–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã (–∫–∞—Ä—Ç–∏–Ω–∫–∏ –Ω–µ –±–ª–æ–∫–∏—Ä—É—é—Ç)
- üé® –ü–ª–∞–≤–Ω—ã–π –ø–µ—Ä–µ—Ö–æ–¥ –æ—Ç blur –∫ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—é
- üì¶ –ù–∞ 40-60% –º–µ–Ω—å—à–µ —Ç—Ä–∞—Ñ–∏–∫–∞ (AVIF/WebP)

**–§–∞–π–ª—ã:**
- `components/media/media-gallery.tsx`
- `next.config.mjs` (–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π)

### 4. Prefetching —Å–ª–µ–¥—É—é—â–∏—Ö –ø–æ—Å—Ç–æ–≤
**–¢–µ—Ö–Ω–æ–ª–æ–≥–∏—è:** –£–º–Ω–∞—è –ø—Ä–µ–¥–∑–∞–≥—Ä—É–∑–∫–∞

**–ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ:**
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–µ–¥–∑–∞–≥—Ä—É–∑–∫–∞ –∫–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—Ä–æ—Å–º–æ—Ç—Ä–µ–ª 80% –ø–æ—Å—Ç–æ–≤
- –¢–∏—Ö–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ (–±–µ–∑ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞)
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –≤–∏—Ä—Ç—É–∞–ª–∏–∑–∞—Ü–∏–µ–π

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- üèÉ –ë–µ—Å—à–æ–≤–Ω–∞—è –ø—Ä–æ–∫—Ä—É—Ç–∫–∞ –±–µ–∑ –æ–∂–∏–¥–∞–Ω–∏—è
- üì° –°–ª–µ–¥—É—é—â–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ —É–∂–µ –≥–æ—Ç–æ–≤–∞ –∫ –ø–æ–∫–∞–∑—É
- üëÅÔ∏è –ù–µ–≤–∏–¥–∏–º–∞—è –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è

**–§–∞–π–ª—ã:**
- `components/feed/infinite-post-list.tsx`

### 5. Service Worker + PWA
**–ë–∏–±–ª–∏–æ—Ç–µ–∫–∞:** `@ducanh2912/next-pwa`

**–ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ:**
- Service Worker —Å –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º
- Offline —Ä–µ–∂–∏–º –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–µ–Ω–Ω—ã—Ö –ø–æ—Å—Ç–æ–≤
- –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ API –∑–∞–ø—Ä–æ—Å–æ–≤ (NetworkFirst, 24 —á–∞—Å–∞)
- –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π (CacheFirst, 30 –¥–Ω–µ–π)
- –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç–∞—Ç–∏–∫–∏ Next.js (CacheFirst, 1 –≥–æ–¥)
- PWA manifest —Å –∏–∫–æ–Ω–∫–∞–º–∏ –∏ shortcuts

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- üì¥ –†–∞–±–æ—Ç–∞ offline –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–µ–Ω–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
- ‚ö° –ú–≥–Ω–æ–≤–µ–Ω–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –ø–æ—Å–µ—â–µ–Ω–∏–π
- üì± –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∫–∞–∫ –Ω–∞—Ç–∏–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
- üöÄ –ù–∞ 70-90% –±—ã—Å—Ç—Ä–µ–µ –ø–æ–≤—Ç–æ—Ä–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞

**–§–∞–π–ª—ã:**
- `next.config.mjs` (–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è PWA)
- `public/manifest.json` (PWA –º–∞–Ω–∏—Ñ–µ—Å—Ç)
- `.gitignore` (–∏—Å–∫–ª—é—á–µ–Ω—ã sw.js —Ñ–∞–π–ª—ã)

## üìä –ò–∑–º–µ—Ä–∏–º—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

### –î–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:
- 1000 –ø–æ—Å—Ç–æ–≤ –≤ DOM = ~15-20 —Å–µ–∫—É–Ω–¥ –¥–æ –ª–∞–≥–∞
- –ü–µ—Ä–≤–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã: ~3-4 —Å–µ–∫—É–Ω–¥—ã
- –ü—Ä–æ–∫—Ä—É—Ç–∫–∞: –∑–∞–º–µ—Ç–Ω—ã–µ —Ñ—Ä–∏–∑—ã –∫–∞–∂–¥—ã–µ 100-200 –ø–æ—Å—Ç–æ–≤
- –ü–æ–≤—Ç–æ—Ä–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞: ~2-3 —Å–µ–∫—É–Ω–¥—ã

### –ü–æ—Å–ª–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:
- 1000 –ø–æ—Å—Ç–æ–≤: —Ç–æ–ª—å–∫–æ ~15-20 –≤ DOM, –æ—Å—Ç–∞–ª—å–Ω—ã–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–µ
- –ü–µ—Ä–≤–∞—è –∑–∞–≥—Ä—É–∑–∫–∞: ~1-2 —Å–µ–∫—É–Ω–¥—ã
- –ü—Ä–æ–∫—Ä—É—Ç–∫–∞: –ø–ª–∞–≤–Ω–∞—è –¥–æ 10,000+ –ø–æ—Å—Ç–æ–≤
- –ü–æ–≤—Ç–æ—Ä–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞: ~0.3-0.5 —Å–µ–∫—É–Ω–¥—ã (–∏–∑ –∫–µ—à–∞)
- Offline —Ä–µ–∂–∏–º: —Ä–∞–±–æ—Ç–∞–µ—Ç –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–µ–Ω–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –í–∏—Ä—Ç—É–∞–ª–∏–∑–∞—Ü–∏—è:
```typescript
const rowVirtualizer = useVirtualizer({
  count: posts.length,
  getScrollElement: () => parentRef.current,
  estimateSize: () => 200, // —Å—Ä–µ–¥–Ω—è—è –≤—ã—Å–æ—Ç–∞
  overscan: 5, // –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã
})
```

### –ú–µ–º–æ–∏–∑–∞—Ü–∏—è PostCard:
```typescript
export const PostCard = memo(PostCardComponent, (prevProps, nextProps) => {
  return prevProps.post.id === nextProps.post.id &&
         prevProps.post.likes === nextProps.post.likes &&
         prevProps.post.comment_count === nextProps.post.comment_count &&
         prevProps.post.user_has_liked === nextProps.post.user_has_liked
})
```

### PWA –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ:
```javascript
runtimeCaching: [
  {
    urlPattern: /^https:\/\/.*\.supabase\.co\/.*/i,
    handler: 'NetworkFirst', // –°–Ω–∞—á–∞–ª–∞ —Å–µ—Ç—å, –ø–æ—Ç–æ–º –∫–µ—à
    options: {
      cacheName: 'supabase-api',
      expiration: { maxAgeSeconds: 24 * 60 * 60 }
    }
  },
  {
    urlPattern: /\.(?:jpg|jpeg|png|gif|webp|avif|svg)$/i,
    handler: 'CacheFirst', // –°–Ω–∞—á–∞–ª–∞ –∫–µ—à, –ø–æ—Ç–æ–º —Å–µ—Ç—å
    options: {
      cacheName: 'images',
      expiration: { maxAgeSeconds: 30 * 24 * 60 * 60 }
    }
  }
]
```

## üéØ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é

### –î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏:
```bash
npm run dev
# PWA –æ—Ç–∫–ª—é—á–µ–Ω –≤ dev —Ä–µ–∂–∏–º–µ
```

### –î–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞:
```bash
npm run build
npm start
# PWA –∞–∫—Ç–∏–≤–µ–Ω, Service Worker —Ä–∞–±–æ—Ç–∞–µ—Ç
```

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ PWA:
1. –°–æ–±–µ—Ä–∏—Ç–µ production –±–∏–ª–¥: `npm run build`
2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ: `npm start`
3. –û—Ç–∫—Ä–æ–π—Ç–µ DevTools ‚Üí Application ‚Üí Service Workers
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ Cache Storage ‚Üí –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –∫–µ—à–∏: `supabase-api`, `images`, `next-static`

## üìù –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

–ï—Å–ª–∏ –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è –µ—â—ë –±–æ–ª—å—à–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–π:

1. **React Server Components** - –¥–ª—è —Å—Ç–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
2. **Suspense Streaming** - –¥–ª—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏
3. **Edge Runtime** - –¥–ª—è –º–æ–ª–Ω–∏–µ–Ω–æ—Å–Ω—ã—Ö API –æ—Ç–≤–µ—Ç–æ–≤
4. **Image CDN** - –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –¥–æ—Å—Ç–∞–≤–∫–∏ –∫–∞—Ä—Ç–∏–Ω–æ–∫
5. **Database indexes** - –¥–ª—è —É—Å–∫–æ—Ä–µ–Ω–∏—è SQL –∑–∞–ø—Ä–æ—Å–æ–≤

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

1. **PWA manifest** —Ç—Ä–µ–±—É–µ—Ç –∏–∫–æ–Ω–∫–∏ (icon-192x192.png, icon-384x384.png, icon-512x512.png)
   - –ü–æ–∫–∞ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è placeholder –ø—É—Ç–∏
   - –î–æ–±–∞–≤—å—Ç–µ —Ä–µ–∞–ª—å–Ω—ã–µ –∏–∫–æ–Ω–∫–∏ –≤ `/public/`

2. **Service Worker** –∫–µ—à–∏—Ä—É–µ—Ç –∫–æ–Ω—Ç–µ–Ω—Ç
   - –ú–æ–∂–µ—Ç –ø–æ—Ç—Ä–µ–±–æ–≤–∞—Ç—å—Å—è —Ä—É—á–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ –∫–µ—à–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏
   - –í production –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ

3. **–í–∏—Ä—Ç—É–∞–ª–∏–∑–∞—Ü–∏—è** —Ç—Ä–µ–±—É–µ—Ç —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ —Ä–æ–¥–∏—Ç–µ–ª—è
   - –ù–µ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≤ –º–æ–¥–∞–ª—å–Ω—ã—Ö –æ–∫–Ω–∞—Ö –±–µ–∑ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
   - –í—ã—Å–æ—Ç–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞

## üöÄ –ò—Ç–æ–≥–æ

–í—Å–µ 5 –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–π —É—Å–ø–µ—à–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã:
- ‚úÖ –í–∏—Ä—Ç—É–∞–ª–∏–∑–∞—Ü–∏—è –ª–µ–Ω—Ç—ã
- ‚úÖ Image lazy loading  
- ‚úÖ –ú–µ–º–æ–∏–∑–∞—Ü–∏—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
- ‚úÖ Prefetching –ø–æ—Å—Ç–æ–≤
- ‚úÖ Service Worker + PWA

–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≥–æ—Ç–æ–≤–æ –∫ —Ä–∞–±–æ—Ç–µ —Å 1000+ –ø–æ—Å—Ç–æ–≤ —Å –≤—ã—Å–æ–∫–æ–π –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å—é!
